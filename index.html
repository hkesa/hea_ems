<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Employer List of Horizon Employment Agency</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, setDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        // ã€è¨­å®šå€åŸŸ 1ã€‘Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD0BE-lK6MAR-MMjhoOR-5jm3_5F2Qw1wo", 
            authDomain: "ems-hea.firebaseapp.com",
            projectId: "ems-hea",
            storageBucket: "ems-hea.firebasestorage.app",
            messagingSenderId: "995449881828",
            appId: "1:995449881828:web:58dd21bd3f072fd8cdd8f1",
            measurementId: "G-RK1QPVSG6L"
        };

        // ã€è¨­å®šå€åŸŸ 2ã€‘Google Sheets App Script URL
        window.GOOGLE_SCRIPT_URL = ""; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        window.isFirebaseMode = false;
        window.db = null;
        window.collection = collection;
        window.addDoc = addDoc;
        window.setDoc = setDoc;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;

        async function initSystem() {
            const isConfigured = firebaseConfig.apiKey && firebaseConfig.apiKey.length > 5;
            
            if (isConfigured) {
                try {
                    const app = initializeApp(firebaseConfig);
                    window.db = getFirestore(app);
                    window.isFirebaseMode = true;
                    window.initApp(); 
                    return;
                } catch (e) {
                    console.error("Firebase Init Error", e);
                    alert("Firebase é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Config");
                }
            } 
            
            console.log("Offline Mode");
            const toast = document.getElementById('offline-toast');
            toast.classList.remove('hidden');
            setTimeout(() => { toast.classList.add('opacity-0'); setTimeout(()=>toast.remove(), 1000); }, 5000);
            
            window.initApp();
        }
        initSystem();
    </script>

    <style>
        :root { --fs-base: 18px; }
        html { font-size: var(--fs-base); } 
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; color: #1f2937; line-height: 1.6; }
        
        body, p, input, select, textarea, label, span, div, li, td, th, h1, h2, h3, h4, .text-lg, .text-xl, .text-2xl, .text-3xl { font-size: var(--fs-base) !important; }
        button, .btn-nav, .wa-btn, .file-btn, .salary-btn { font-size: var(--fs-base) !important; }
        
        .btn-nav { padding: 10px 20px; font-weight: bold; }
        .btn-nav.active { background-color: #1e40af; color: white; }
        .hidden-section { display: none; }
        
        #main-nav { transition: all 0.3s ease-in-out; }
        #main-nav.shrink { padding-top: 5px; padding-bottom: 5px; }
        
        @media (max-width: 640px) {
            #main-nav.shrink { padding-top: 2px; padding-bottom: 2px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
            #main-nav.shrink .nav-logo { font-size: 1.1rem !important; }
            .btn-nav-container { flex-wrap: nowrap !important; gap: 4px !important; width: 100%; padding-left: 5px; padding-right: 5px; }
            .btn-nav { padding: 8px 5px !important; font-size: 14px !important; flex: 1; white-space: nowrap; display: flex; justify-content: center; align-items: center; }
        }

        .wa-btn {
            background-color: #25D366; color: white;
            font-weight: bold; padding: 12px 24px; border-radius: 50px;
            display: inline-flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;
            text-decoration: none;
        }
        .wa-btn:hover { transform: scale(1.05); background-color: #1ebc57; }

        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            color: #1e40af; transition: opacity 0.5s;
        }
        
        input, select, textarea { padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; width: 100%; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        input[type="date"].date-left-icon { position: relative; padding-left: 42px; }
        input[type="date"].date-left-icon::-webkit-calendar-picker-indicator {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; cursor: pointer; padding: 0; margin: 0; opacity: 0.6;
        }
        input[type="date"].date-left-icon::-webkit-calendar-picker-indicator:hover { opacity: 1; }
        input[type="date"].date-left-icon::-webkit-datetime-edit { margin-left: 0; }
        
        .salary-btn {
            background-color: #e5e7eb; color: #374151; width: 60px; height: 100%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; user-select: none; font-weight: bold;
        }
        .salary-btn:hover { background-color: #d1d5db; }

        /* Error Message Style B002 */
        .error-msg { 
            background-color: #fee2e2; /* Light Red */
            color: #991b1b; /* Dark Red */
            padding: 6px 10px; 
            border-radius: 4px; 
            margin-top: 6px; 
            display: none; 
            font-weight: bold; 
            font-size: 0.9rem !important;
        }
        .error-msg.visible { display: block; }
        .input-error { border-color: #ef4444 !important; border-width: 2px !important; }

        .tag-checkbox:checked + label { background-color: #fce7f3; color: #9f1239; border-color: #f472b6; }
        .tag-checkbox:checked + label::before { content: 'âœ” '; }
        
        .internal-field { background-color: #f0f9ff; border: 2px solid #bae6fd; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .internal-label { color: #0369a1; font-weight: bold; display: block; margin-bottom: 8px; }
        
        .info-box {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border-left: 6px solid #3b82f6;
            padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .info-box h3 { color: #1e40af; margin-bottom: 15px; font-weight: bold; }
        .info-box p { margin-bottom: 12px; }
        .info-box li { margin-bottom: 8px; }
        .info-box a { color: #2563eb; text-decoration: underline; font-weight: bold; }
        
        /* Edit Section Style */
        #admin-edit-area { border: 3px solid #f59e0b; }
        #admin-edit-area .internal-field { border-color: #fcd34d; background-color: #fffbeb; }
        #edit-header { background-color: #fef3c7; border-bottom: 2px solid #fcd34d; }
    </style>
</head>
<body class="pb-40 text-gray-800">

    <div id="loading-overlay">
        <div class="text-center">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl mb-4"></i><br>
            <span id="loading-text" class="text-xl font-bold">ç³»çµ±å•Ÿå‹•ä¸­...</span>
        </div>
    </div>

    <div id="offline-toast" class="hidden fixed bottom-5 right-5 bg-white border-l-4 border-orange-500 text-gray-700 p-4 rounded shadow-lg z-50 transition-opacity duration-1000 max-w-sm text-base">
        <p class="font-bold"><i class="fa-solid fa-triangle-exclamation text-orange-500"></i> ç›®å‰ç‚ºå–®æ©Ÿæ¨¡å¼</p>
        <p class="mt-1">å°šæœªè¨­å®š Firebaseã€‚</p>
    </div>

    <!-- å°èˆª -->
    <nav id="main-nav" class="bg-white shadow-md sticky top-0 z-50 py-4">
        <div class="max-w-screen-2xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex flex-col items-center md:items-start mb-2 md:mb-0 w-full md:w-auto">
                    <div class="nav-logo font-bold text-blue-900 text-center md:text-left text-2xl">
                        Employer List
                    </div>
                    <div id="mode-badge" class="mt-1 hidden"></div>
                </div>
                <div class="btn-nav-container flex gap-2 flex-wrap justify-center md:justify-end">
                    <button onclick="switchTab('admin')" id="nav-admin" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡­ğŸ‡° Agency</button>
                    <button onclick="switchTab('english')" id="nav-english" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡µğŸ‡­ English</button>
                    <button onclick="switchTab('indonesian')" id="nav-indonesian" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡®ğŸ‡© Indonesian</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 1. ç™»å…¥é é¢ -->
    <section id="page-login" class="max-w-4xl mx-auto mt-10 p-6 hidden-section">
        <div class="grid grid-cols-1 gap-6 mb-10">
            <div class="info-box">
                <h3>Contact Information</h3>
                <p><b>Agency Name:</b> Horizon Employment Agency</p>
                <p><b>Agency Address:</b> Flat B, 5/F, Gaylord Commercial Building, 114-118 Lockhart Road, Wan Chai, Hong Kong</p>
                <p><b>Agency WhatsApp:</b> <a href="https://wa.me/85296111003" target="_blank">(+852) 96111003</a></p>
                <p><b>Like our Facebook:</b> <a href="https://www.facebook.com/HorizonHelpers" target="_blank">Horizon Helpers</a></p>
            </div>
            
            <div class="info-box" style="border-left-color: #10b981;">
                <h3>We need many</h3>
                <ul class="list-none pl-0">
                    <li>1ï¸âƒ£ Helpers</li>
                    <li>2ï¸âƒ£ Drivers</li>
                    <li>3ï¸âƒ£ Teachers</li>
                    <li>4ï¸âƒ£ Caregivers</li>
                    <li>5ï¸âƒ£ Nurses</li>
                    <li>6ï¸âƒ£ Gardeners</li>
                    <li>7ï¸âƒ£ Filipinos</li>
                    <li>8ï¸âƒ£ Indonesians</li>
                </ul>
                <!-- Added Section -->
                <h3 class="mt-6">Refer your friends and family</h3>
                <ul class="list-none pl-0">
                    <li>1ï¸âƒ£ From overseas</li>
                    <li>2ï¸âƒ£ Finishing contract in HK</li>
                    <li>3ï¸âƒ£ Refer an employer</li>
                    <li>4ï¸âƒ£ Renewing a contract</li>
                    <li>5ï¸âƒ£ Direct hire</li>
                    <li>6ï¸âƒ£ Friend of a friend</li>
                </ul>
            </div>
        </div>

        <div class="bg-white p-10 rounded-xl shadow-lg max-w-2xl mx-auto">
            <div class="text-center mb-8">
                <h2 class="font-bold text-gray-800">ç®¡ç†å“¡ç™»å…¥ Administrator Login</h2>
                <p class="text-gray-500 mt-4">è«‹è¼¸å…¥å¯†ç¢¼ä»¥ç¹¼çºŒ<br>Please enter password to continue</p>
            </div>
            <div class="mb-8">
                <input type="password" id="admin-password" class="w-full" placeholder="è¼¸å…¥å¯†ç¢¼ Enter Password">
                <p id="login-error" class="text-red-500 mt-2 hidden">å¯†ç¢¼éŒ¯èª¤ / Incorrect Password</p>
            </div>
            <button onclick="checkLogin()" class="w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-bold transition shadow">ç™»å…¥ Login</button>
        </div>
    </section>

    <!-- 2. ç®¡ç†å“¡å¾Œå° -->
    <section id="page-admin" class="max-w-screen-xl mx-auto mt-10 px-4 hidden-section">
        <div class="flex flex-wrap gap-4 mb-8 border-b pb-4 items-center">
             <button onclick="switchAdminSub('list')" id="sub-btn-list" class="px-6 py-3 rounded-full bg-yellow-100 text-yellow-800 font-bold hover:bg-yellow-200 transition">å·²ä¸Šè¼‰çš„è³‡æ–™</button>
             <button onclick="switchAdminSub('input')" id="sub-btn-input" class="px-6 py-3 rounded-full bg-blue-100 text-blue-800 font-bold hover:bg-blue-200 transition">æ–°è³‡æ–™è¼¸å…¥å™¨</button>
             <button onclick="switchAdminSub('edit')" id="sub-btn-edit" class="hidden px-6 py-3 rounded-full bg-orange-100 text-orange-800 font-bold hover:bg-orange-200 transition">ä¿®æ”¹è³‡æ–™</button>
             
             <div class="ml-auto flex gap-4">
                <button onclick="switchAdminSub('fishing')" id="sub-btn-fishing" class="px-6 py-3 rounded-full bg-purple-100 text-purple-800 font-bold hover:bg-purple-200 transition">é‡£é­šç›¤</button>
                <button onclick="logout()" class="px-6 py-3 rounded-full bg-gray-200 text-gray-800 font-bold hover:bg-gray-300 transition"><i class="fa-solid fa-right-from-bracket"></i> ç™»å‡º</button>
             </div>
        </div>

        <!-- LIST AREA -->
        <div id="admin-list-area" class="hidden">
            <h3 class="font-bold text-blue-900 mb-6">å·²ä¸Šè¼‰çš„è³‡æ–™ <span id="db-status-text" class="font-normal text-gray-500"></span></h3>
            <div id="admin-records-container" class="space-y-8"></div>
            <div id="admin-pagination" class="flex justify-center items-center gap-8 mt-10 hidden">
                <button onclick="changeAdminPage(-1)" class="px-6 py-3 bg-white border rounded hover:bg-gray-100">Prev</button>
                <span id="admin-page-indicator" class="font-bold text-gray-700">Page 1</span>
                <button onclick="changeAdminPage(1)" class="px-6 py-3 bg-white border rounded hover:bg-gray-100">Next</button>
            </div>
        </div>

        <!-- INPUT / FISHING AREA -->
        <div id="admin-input-area" class="bg-white p-8 rounded-xl shadow-md hidden">
            <div id="fishing-header" class="hidden mb-8 bg-purple-50 p-6 rounded-lg border border-purple-200 flex justify-between items-center">
                <span class="font-bold text-purple-800">ğŸ¬ é‡£é­šç›¤æ¨¡å¼ (éš¨æ©Ÿç”Ÿæˆ)</span>
                <button onclick="generateFishingData()" class="bg-purple-600 text-white px-6 py-3 rounded font-bold hover:bg-purple-700 transition">é‡æ–°ç”Ÿæˆæ•¸æ“š</button>
            </div>

            <div id="clear-btn-container" class="mb-4 flex flex-col sm:flex-row justify-start items-center gap-4 bg-gray-50 p-3 rounded-lg border border-gray-100">
                <button type="button" onclick="clearInputForm('input')" class="bg-red-50 text-red-600 px-4 py-2 rounded border border-red-200 hover:bg-red-100 font-bold whitespace-nowrap">
                    <i class="fa-solid fa-trash mr-1"></i> æ¸…é™¤å…§å®¹
                </button>
                <span class="text-sm text-red-600 font-bold">æ¯æ¬¡è¼¸å…¥æ–°è³‡æ–™å‰ï¼Œå…ˆæŒ‰ä¸€æŒ‰ã€Œæ¸…é™¤å…§å®¹ã€æŒ‰éˆ•</span>
            </div>

            <!-- Main Form Container -->
            <div id="form-container-main"></div>
            
            <div id="fishing-footer" class="hidden mt-4 p-4 bg-purple-50 text-purple-700 rounded text-center font-bold">
                é‡£é­šç›¤æ¨¡å¼ç”Ÿæ•ˆä¸­
            </div>
        </div>

        <!-- EDIT AREA (Independent Page) -->
        <div id="admin-edit-area" class="bg-white p-8 rounded-xl shadow-md hidden">
            <div id="edit-header" class="mb-8 p-6 rounded-t-lg flex justify-between items-center">
                <span class="font-bold text-orange-800"><i class="fa-solid fa-pen-to-square"></i> ä¿®æ”¹è³‡æ–™æ¨¡å¼</span>
                <button onclick="closeEditMode()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300">å–æ¶ˆä¿®æ”¹</button>
            </div>
            <!-- Edit Form Container (Will be populated by JS) -->
            <div id="form-container-edit"></div>
        </div>

    </section>

    <!-- 3. å…¬é–‹é é¢ -->
    <section id="page-public" class="max-w-screen-2xl mx-auto mt-10 px-4 hidden-section">
        <div class="mb-10 flex flex-col items-center">
            <div id="banner-box" class="w-full max-w-5xl mb-6 p-6 rounded-lg text-left shadow-md border-l-8 bg-blue-50 border-blue-300 text-black">
                <p id="banner-text" class="leading-relaxed"></p>
            </div>
            <a href="https://wa.me/85296111003" target="_blank" class="wa-btn">
                <i class="fa-brands fa-whatsapp" style="font-size: 40px;"></i> <span id="wa-text">WhatsApp 9611 1003</span>
            </a>
        </div>

        <h2 id="public-title" class="font-bold text-blue-900 mb-8 border-l-8 border-blue-500 pl-6">Employer List</h2>

        <div id="public-records-container" class="grid grid-cols-1 md:grid-cols-2 gap-10"></div>

        <div id="pagination-controls" class="flex flex-col items-center gap-4 mt-16 mb-20">
            <div class="flex justify-center gap-8">
                <button onclick="changePage(-1)" id="btn-prev" class="px-8 py-4 bg-white border rounded-lg hover:bg-gray-100 font-bold shadow">Prev</button>
                <span id="page-indicator" class="font-bold text-gray-700 self-center">Page 1</span>
                <button onclick="changePage(1)" id="btn-next" class="px-8 py-4 bg-white border rounded-lg hover:bg-gray-100 font-bold shadow">Next</button>
            </div>
            <div id="public-footer-msg" class="w-full max-w-5xl p-4 bg-blue-50 text-black text-center rounded-lg mt-4 hidden"></div>
            <!-- Version Update -->
            <div class="text-center text-gray-400 mt-10 mb-4">V1.19</div>
        </div>
    </section>

    <!-- Form Template (Hidden, used to clone) -->
    <template id="form-template">
        <form class="employer-form space-y-8">
            <input type="hidden" class="edit-doc-id"> 
            
            <!-- 1. åƒ±ä¸»ç·¨è™Ÿ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2 label-id">åƒ±ä¸»ç·¨è™Ÿ (ç·¨è™Ÿä»¥Eé–‹å§‹ï¼Œä¾‹å¦‚ï¼šE2805)</label>
                <input type="text" class="inp-id bg-gray-50" placeholder="ä¾‹å¦‚ï¼šE2805" onblur="validate(this)">
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 2. å®¶åº­æˆå“¡ -->
            <div class="flex flex-col p-6 bg-gray-50 rounded-lg border">
                <label class="font-bold text-gray-700 mb-3">å®¶åº­æˆå“¡åŠå¹´é½¡ (å¯ä»¥å¤šé¸)</label>
                <div class="member-list-display mb-3 flex flex-wrap gap-3 min-h-[40px]"></div>
                <input type="hidden" class="inp-members-string" onblur="validateMember(this)">
                <div class="error-msg member-error">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                
                <div class="flex gap-4 items-end">
                    <div class="flex-1">
                        <label class="text-gray-500 mb-1 block">æˆå“¡é¡å‹</label>
                        <select class="mem-type" onchange="toggleAgeInput(this)">
                            <option value="æˆäºº">æˆäºº Adult</option>
                            <option value="å°å­©">å°å­© Child</option>
                            <option value="ç”·å­©">ç”·å­© Boy</option>
                            <option value="å¥³å­©">å¥³å­© Girl</option>
                            <option value="é›™èƒèƒ">é›™èƒèƒ Twins</option>
                            <option value="ä¸‰èƒèƒ">ä¸‰èƒèƒ Triplets</option>
                            <option value="é•·è€…">é•·è€… Elderly</option>
                            <option value="å…¬å…¬">å…¬å…¬ Grandpa</option>
                            <option value="å©†å©†">å©†å©† Grandma</option>
                        </select>
                    </div>
                    <div class="w-32 hidden age-input-group">
                        <label class="text-gray-500 mb-1 block">å¹´é½¡</label>
                        <input type="number" class="mem-age" placeholder="æ­²">
                    </div>
                    <button type="button" onclick="addMember(this)" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 h-full">æ–°å¢</button>
                </div>
            </div>

            <!-- 3. åœ°å€ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">åƒ±ä¸»åœ°å€ (Employer Location)</label>
                <input type="text" class="inp-location" placeholder="ä¾‹å¦‚ï¼šå°‡è»æ¾³" onblur="validate(this)">
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- å…§éƒ¨æ¬„ä½ï¼šå–®ä½å‘æ•¸ -->
            <div class="flex flex-col internal-field input-only-field">
                <label class="internal-label"><i class="fa-solid fa-lock"></i> å–®ä½å‘æ•¸ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                <input type="text" class="inp-flat-size" placeholder="ä¾‹å¦‚ï¼š500å‘" onblur="validate(this)">
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 4. å¯µç‰© -->
            <div class="flex flex-col p-6 bg-gray-50 rounded-lg border">
                <label class="font-bold text-gray-700 mb-3">å¯µç‰© (å¯ä»¥å¤šé¸)</label>
                <div class="pet-list-display mb-3 flex flex-wrap gap-3 min-h-[40px]"></div>
                <input type="hidden" class="inp-pets-string" onblur="validatePet(this)">
                <div class="error-msg pet-error">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                
                <div class="flex gap-4 items-end flex-wrap">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-gray-500 mb-1 block">å¯µç‰©é¡å‹</label>
                        <select class="pet-add-type" onchange="togglePetInputs(this)">
                            <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                            <option value="æ²’æœ‰å¯µç‰©">æ²’æœ‰å¯µç‰©</option>
                            <option value="å°ç‹—">å°ç‹— Small Dog</option>
                            <option value="ä¸­ç‹—">ä¸­ç‹— Medium Dog</option>
                            <option value="å¤§ç‹—">å¤§ç‹— Big Dog</option>
                            <option value="è²“">è²“ Cat</option>
                            <option value="å…”">å…” Rabbit</option>
                            <option value="é¸šéµ¡">é¸šéµ¡ Parrot</option>
                            <option value="çƒé¾œ">çƒé¾œ Turtle</option>
                            <option value="å…¶ä»–">å…¶ä»– Other</option>
                        </select>
                    </div>
                    <div class="w-full hidden order-last mt-2 pet-other-group">
                        <input type="text" class="inp-pets-other-text" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«ï¼Œä¾‹å¦‚ï¼šHamster">
                    </div>
                    <div class="w-40 hidden pet-qty-group">
                            <label class="text-gray-500 mb-1 block">æ•¸é‡</label>
                            <div class="flex border rounded-lg overflow-hidden bg-white h-[54px]">
                                <input type="number" class="pet-add-qty w-full p-2 text-center border-none outline-none" value="1" min="1" style="font-size: 26px;">
                                <div class="flex gap-1 pr-1 items-center bg-gray-100">
                                    <button type="button" onclick="adjPet(this, 1)" class="w-12 h-full bg-gray-200 hover:bg-gray-300 font-bold text-xl">â–²</button>
                                    <button type="button" onclick="adjPet(this, -1)" class="w-12 h-full bg-gray-200 hover:bg-gray-300 font-bold text-xl">â–¼</button>
                                </div>
                            </div>
                    </div>
                    <button type="button" onclick="addPetToList(this)" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 h-[54px]">æ–°å¢</button>
                </div>
            </div>

            <!-- 5. å·¥äººæˆ¿ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">å·¥äººæˆ¿ (Helper Room)</label>
                <select class="inp-room" onchange="toggleRoomOther(this)" onblur="validate(this)">
                    <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                    <option value="æœ‰å·¥äººæˆ¿">æœ‰å·¥äººæˆ¿</option>
                    <option value="èˆ‡å°å­©åŒæˆ¿">èˆ‡å°å­©åŒæˆ¿</option>
                    <option value="èˆ‡é•·è€…åŒæˆ¿">èˆ‡é•·è€…åŒæˆ¿</option>
                    <option value="èˆ‡å¦å¤–å‚­åŒæˆ¿">èˆ‡å¦å¤–å‚­åŒæˆ¿</option>
                    <option value="èˆ‡å¥³åƒ±ä¸»åŒæˆ¿">èˆ‡å¥³åƒ±ä¸»åŒæˆ¿</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <input type="text" class="inp-room-other mt-2 hidden" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«" onblur="validateOther(this, '.inp-room')">
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 6. ä¸Šç­æ—¥æœŸ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">ä¸Šç­æ—¥æœŸ (Start Date)</label>
                <select class="inp-date" onblur="validate(this)">
                    <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                    <option value="ç›¡å¿«">ç›¡å¿«</option>
                    <option value="ä¸€æœˆ">ä¸€æœˆ</option>
                    <option value="äºŒæœˆ">äºŒæœˆ</option>
                    <option value="ä¸‰æœˆ">ä¸‰æœˆ</option>
                    <option value="å››æœˆ">å››æœˆ</option>
                    <option value="äº”æœˆ">äº”æœˆ</option>
                    <option value="å…­æœˆ">å…­æœˆ</option>
                    <option value="ä¸ƒæœˆ">ä¸ƒæœˆ</option>
                    <option value="å…«æœˆ">å…«æœˆ</option>
                    <option value="ä¹æœˆ">ä¹æœˆ</option>
                    <option value="åæœˆ">åæœˆ</option>
                    <option value="åä¸€æœˆ">åä¸€æœˆ</option>
                    <option value="åäºŒæœˆ">åäºŒæœˆ</option>
                </select>
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 7. è–ªé‡‘ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">è–ªé‡‘ (Salary)</label>
                <div class="flex items-center gap-3">
                    <input type="number" class="inp-salary flex-1" placeholder="ä¾‹å¦‚ï¼š5100" onblur="validate(this)">
                    <div class="flex gap-2 h-full">
                        <div onclick="adjustSalary(this, 100)" class="salary-btn rounded-l-lg border border-gray-300">â–²</div>
                        <div onclick="adjustSalary(this, -100)" class="salary-btn rounded-r-lg border border-gray-300">â–¼</div>
                    </div>
                </div>
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- å…§éƒ¨æ¬„ä½ï¼šè˜è«‹é¡åˆ¥ -->
            <div class="flex flex-col internal-field input-only-field mt-2">
                <label class="internal-label"><i class="fa-solid fa-lock"></i> è˜è«‹é¡åˆ¥ (å¯ä»¥å¤šé¸) å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„</label>
                <div class="flex flex-wrap gap-3 overseas-options"></div>
                <input type="hidden" class="inp-overseas-local">
                <div class="error-msg overseas-error">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 8. åœ‹ç± -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">åœ‹ç±è¦æ±‚ (Nationality Required)</label>
                <select class="inp-nationality" onchange="toggleNatOther(this)" onblur="validate(this)">
                    <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                    <option value="Filipino">è²å‚­ Filipino</option>
                    <option value="Indonesian">å°å‚­ Indonesian</option>
                    <option value="Filipino & Indonesian">è²å° Filipino & Indonesian</option>
                    <option value="Indonesian & Filipino">å°è² Indonesian & Filipino</option>
                    <option value="Other">å…¶ä»– (Other)</option>
                </select>
                <input type="text" class="inp-nationality-other mt-2 hidden" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«ï¼Œä¾‹å¦‚ï¼šSri Lankans" onblur="validateOther(this, '.inp-nationality')">
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- 9. èªè¨€ -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">èªè¨€è¦æ±‚ (Language Required)</label>
                <select class="inp-lang" onblur="validate(this)">
                    <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                    <option value="è‹±æ–‡">è‹±æ–‡</option>
                    <option value="å»£æ±è©±">å»£æ±è©±</option>
                    <option value="æ™®é€šè©±">æ™®é€šè©±</option>
                    <option value="è‹±æ–‡&å»£æ±è©±">è‹±æ–‡&å»£æ±è©±</option>
                    <option value="è‹±æ–‡&æ™®é€šè©±">è‹±æ–‡&æ™®é€šè©±</option>
                </select>
                <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
            </div>

            <!-- å…§éƒ¨æ¬„ä½ï¼šåƒ±ä¸»è¦æ±‚ -->
            <div class="flex flex-col internal-field input-only-field mt-2">
                <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»è¦æ±‚æˆ–ç•™è¨€ (å¦‚æœ‰) å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„</label>
                <textarea class="inp-emp-req h-32" placeholder="å…¬å¸å…§éƒ¨ä½¿ç”¨ï¼Œä¸å¤–å‚³"></textarea>
            </div>

            <!-- 10. å‚™è¨» -->
            <div class="flex flex-col">
                <label class="font-bold text-gray-700 mb-2">å…¬é–‹å‚™è¨»çµ¦å¤–å‚­çœ‹ (å¦‚æœ‰) (Remarks)</label>
                <textarea class="inp-remarks h-32" placeholder="çµ¦å¤–å‚­çœ‹ï¼Œæœƒå¤–å‚³ï¼Œè«‹å°å¿ƒå¡«å¯«ï¼Œè«‹ä»¥è‹±æ–‡å¡«å¯«"></textarea>
            </div>

            <!-- Tags Section -->
            <div class="flex flex-col p-6 bg-pink-50 border border-pink-200 rounded-lg">
                <label class="font-bold text-pink-800 mb-3">åŠ ä¸Šæ¨™ç±¤ (å¦‚æœ‰) å¯ä»¥å¤šé¸</label>
                <div class="tags-container flex flex-wrap gap-3 mb-3"></div>
                <div class="mt-2 tag-other-div">
                    <input type="checkbox" class="hidden tag-other-check" onchange="toggleTagOther(this)">
                    <label class="bg-white border border-pink-300 text-pink-700 px-4 py-2 rounded cursor-pointer hover:bg-pink-100 select-none tag-other-label">å…¶ä»– Other</label>
                    <input type="text" class="mt-2 w-full hidden tag-other-text" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«" onblur="validateTagOther(this)">
                    <div class="error-msg tag-other-error">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
            </div>

            <!-- å…§éƒ¨æ¬„ä½ç¾¤çµ„ (Input Only) -->
            <div class="flex flex-col gap-6 mt-4 input-only-field">
                <div class="flex flex-col internal-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»å§“å (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <input type="text" class="inp-emp-name" onblur="validate(this)">
                    <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
                <div class="flex flex-col internal-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»èªè¨€ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <select class="inp-emp-lang" onblur="validate(this)">
                        <option value="">è«‹é¸æ“‡...</option>
                        <option value="è‹±æ–‡">è‹±æ–‡</option>
                        <option value="å»£æ±è©±">å»£æ±è©±</option>
                        <option value="æ™®é€šè©±">æ™®é€šè©±</option>
                        <option value="æ™®é€šè©±ä½†è­˜å»£æ±è©±">æ™®é€šè©±ä½†è­˜å»£æ±è©±</option>
                    </select>
                    <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
                <div class="flex flex-col internal-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»é›»è©± (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <input type="text" class="inp-emp-phone" onblur="validate(this)">
                    <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
                <div class="flex flex-col internal-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> æŸ¥è©¢æ—¥æœŸ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <input type="date" class="inp-inquiry-date date-left-icon" onblur="validate(this)">
                    <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
                <div class="flex flex-col internal-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> ä»‹ç´¹äºº (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <input type="text" class="inp-referrer" placeholder="ä¾‹å¦‚ï¼šèˆŠå®¢E1234ã€Googleå»£å‘Š" onblur="validate(this)">
                    <div class="error-msg">ä½ æ¼å¡«æ­¤æ¬„ï¼Œè«‹å¡«å¯«å¾Œå†ä¸Šè¼‰è³‡æ–™</div>
                </div>
            </div>

            <button type="button" onclick="handleSave(this)" class="btn-save w-full bg-green-600 text-white font-bold py-5 rounded-xl hover:bg-green-700 mt-10 shadow transition">
                <i class="fa-solid fa-upload mr-2"></i> <span class="btn-save-text">ä¸Šè¼‰è³‡æ–™</span>
            </button>
        </form>
    </template>

    <script>
        let employers = []; // Real employers (E)
        let fishingData = []; // Fishing data (U)
        const PASSWORD = 'admin@ADA2018';
        let currentPage = 1;
        let currentAdminPage = 1;
        const itemsPerPage = 10;
        let currentLang = 'english';
        
        let currentAdminSub = 'list';
        let activeFormId = null; // 'form-main' or 'form-edit'

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('main-nav');
            if (window.scrollY > 50) { nav.classList.add('shrink'); } 
            else { nav.classList.remove('shrink'); }
        });

        const tagList = [
            "æ€¥ Urgent", "é«˜è–ª High salary", "è¿‘åœ°éµ Near MTR", "å¤§å­¸ University", "å¥½åƒ±ä¸» Good employer",
            "ä¸€å€‹å°å­© 1 child only", "ä¸€å€‹é•·è€… 1 elderly only", "2å€‹é•·è€… 2 elderly only", "3å€‹é•·è€… 3 elderly only",
            "ä¸€ä½æˆäºº 1 adult only", "2ä½æˆäºº 2 adult only", "3ä½æˆäºº 3 adult only",
            "è«‹å¸æ©Ÿ Hire Driver", "è«‹æµ·å¤– Hire overseas helper", "è«‹ç”·å¤–å‚­ Hire male helper",
            "ç‹—ç¶“é©— Dog experience", "è²“ç¶“é©— Cat experience", "å¯µç‰©ç¶“é©— Pet experience",
            "è­·å£«ç¶“é©— Nursing experience", "è€å¸«ç¶“é©— Teacher experience", "åˆç”Ÿç¶“é©— Babysitter experience", "ç…§é¡§è€…ç¶“é©— Caregiver experience",
            "ç…§é¡§ç‰¹åˆ¥ Special care", "ç…§é¡§æ®˜ç–¾ Disability care", "ç…§é¡§ç™±ç˜“ Bedridden care", "ç…§é¡§æ’å–‰ Tracheostomy care",
            "æ¨è¼ªæ¤… Wheelchair", "èµ°è·¯ç·©æ…¢ Walking slowly", "é¤µè—¥ Medication feeding", "æ²–æ¶¼ Bathing assistance",
            "ä¸­é¢¨ Stroke", "è€äººç—´å‘† Alzheimer's disease", "æŸé‡‘éœç—… Parkinson's disease", "çºŒç´„å„ªå…ˆ Renewal priority"
        ];

        const fishingTags = ["æ€¥ Urgent", "é«˜è–ª High salary", "è¿‘åœ°éµ Near MTR", "å¤§å­¸ University", "å¥½åƒ±ä¸» Good employer"];
        
        const tagMapIndo = {
            "æ€¥ Urgent": "Mendesak", "é«˜è–ª High salary": "Gaji tinggi", "è¿‘åœ°éµ Near MTR": "Dekat MTR", "å¤§å­¸ University": "Universitas", "å¥½åƒ±ä¸» Good employer": "Majikan baik",
            "ä¸€å€‹å°å­© 1 child only": "Hanya 1 anak", "ä¸€å€‹é•·è€… 1 elderly only": "Hanya 1 lansia", "2å€‹é•·è€… 2 elderly only": "Hanya 2 lansia", "3å€‹é•·è€… 3 elderly only": "Hanya 3 lansia",
            "ä¸€ä½æˆäºº 1 adult only": "Hanya 1 dewasa", "2ä½æˆäºº 2 adult only": "Hanya 2 dewasa", "3ä½æˆäºº 3 adult only": "Hanya 3 dewasa",
            "è«‹å¸æ©Ÿ Hire Driver": "Merekrut sopir", "è«‹æµ·å¤– Hire overseas helper": "Merekrut PRT luar negeri", "è«‹ç”·å¤–å‚­ Hire male helper": "Merekrut PRT laki-laki",
            "ç‹—ç¶“é©— Dog experience": "Pengalaman merawat anjing", "è²“ç¶“é©— Cat experience": "Pengalaman merawat kucing", "å¯µç‰©ç¶“é©— Pet experience": "Pengalaman merawat hewan peliharaan",
            "è­·å£«ç¶“é©— Nursing experience": "Pengalaman keperawatan", "è€å¸«ç¶“é©— Teacher experience": "Pengalaman sebagai guru", "åˆç”Ÿç¶“é©— Babysitter experience": "Pengalaman menjaga bayi baru lahir",
            "ç…§é¡§è€…ç¶“é©— Caregiver experience": "Pengalaman merawat lansia", "ç…§é¡§ç‰¹åˆ¥ Special care": "Perawatan khusus", "ç…§é¡§æ®˜ç–¾ Disability care": "Perawatan disabilitas",
            "ç…§é¡§ç™±ç˜“ Bedridden care": "Perawatan pasien terbaring", "ç…§é¡§æ’å–‰ Tracheostomy care": "Perawatan trakeostomi", "æ¨è¼ªæ¤… Wheelchair": "Dorong kursi roda",
            "èµ°è·¯ç·©æ…¢ Walking slowly": "Berjalan perlahan", "é¤µè—¥ Medication feeding": "Pemberian obat", "æ²–æ¶¼ Bathing assistance": "Bantuan mandi",
            "ä¸­é¢¨ Stroke": "Stroke", "è€äººç—´å‘† Alzheimer's disease": "Penyakit Alzheimer", "æŸé‡‘éœç—… Parkinson's disease": "Penyakit Parkinson", "çºŒç´„å„ªå…ˆ Renewal priority": "Prioritas perpanjangan kontrak",
            "å…¶ä»– Other": "Lainnya"
        };

        const overseasList = ["æœ¬åœ°", "æµ·å¤–", "æœªå‡ºåœ‹", "exé¦™æ¸¯", "ä¸­æ±", "å°ç£", "æ–°åŠ å¡", "é¦¬ä¾†è¥¿äº"];

        const locationMap = {
            "ä¸­ç’°": "Central", "é‡‘é˜": "Admiralty", "ç£ä»”": "Wan Chai", "éŠ…é‘¼ç£": "Causeway Bay", "åŒ—è§’": "North Point",
            "å¤ªå¤": "Tai Koo", "ç­²ç®•ç£": "Shau Kei Wan", "æŸ´ç£": "Chai Wan", "å°–æ²™å’€": "Tsim Sha Tsui", "ä½æ•¦": "Jordan",
            "æ²¹éº»åœ°": "Yau Ma Tei", "æ—ºè§’": "Mong Kok", "å¤ªå­": "Prince Edward", "æ·±æ°´åŸ—": "Sham Shui Po", "é•·æ²™ç£": "Cheung Sha Wan",
            "è”æè§’": "Lai Chi Kok", "ç¾å­š": "Mei Foo", "ä¹é¾å¡˜": "Kowloon Tong", "é»ƒå¤§ä»™": "Wong Tai Sin", "é‘½çŸ³å±±": "Diamond Hill",
            "å½©è™¹": "Choi Hung", "ä¹é¾ç£": "Kowloon Bay", "ç‰›é ­è§’": "Ngau Tau Kok", "è§€å¡˜": "Kwun Tong", "è—ç”°": "Lam Tin",
            "èª¿æ™¯å¶º": "Tiu Keng Leng", "å°‡è»æ¾³": "Tseung Kwan O", "å‘å£": "Hang Hau", "å¯¶ç³": "Po Lam", "å¤§åœ": "Tai Wai",
            "æ²™ç”°": "Sha Tin", "ç«ç‚­": "Fo Tan", "å¤§å­¸": "University", "å¤§åŸ”å¢Ÿ": "Tai Po Market", "å¤ªå’Œ": "Tai Wo",
            "ç²‰å¶º": "Fanling", "ä¸Šæ°´": "Sheung Shui", "èƒç£": "Tsuen Wan", "å¤§çª©å£": "Tai Wo Hau", "è‘µèˆˆ": "Kwai Hing",
            "è‘µèŠ³": "Kwai Fong", "é’è¡£": "Tsing Yi", "æ±æ¶Œ": "Tung Chung", "å…ƒæœ—": "Yuen Long", "å±¯é–€": "Tuen Mun", "å¤©æ°´åœ": "Tin Shui Wai"
        };

        const dict = {
            'æœ‰å·¥äººæˆ¿': { en: 'Yes, have own room', id: 'Ya, ada kamar sendiri' },
            'èˆ‡å°å­©åŒæˆ¿': { en: 'Share room with kid', id: 'Berbagi kamar dengan anak' },
            'èˆ‡é•·è€…åŒæˆ¿': { en: 'Share room with elderly', id: 'Berbagi kamar dengan lansia' },
            'èˆ‡å¦å¤–å‚­åŒæˆ¿': { en: 'Share with other helper', id: 'Berbagi dengan pembantu lain' },
            'èˆ‡å¥³åƒ±ä¸»åŒæˆ¿': { en: 'Share with female employer', id: 'Berbagi dengan majikan wanita' },
            'ç›¡å¿«': { en: 'ASAP', id: 'Secepatnya' },
            'ä¸€æœˆ': { en: 'January', id: 'Januari' }, 'äºŒæœˆ': { en: 'February', id: 'Februari' }, 'ä¸‰æœˆ': { en: 'March', id: 'Maret' },
            'å››æœˆ': { en: 'April', id: 'April' }, 'äº”æœˆ': { en: 'May', id: 'Mei' }, 'å…­æœˆ': { en: 'June', id: 'Juni' },
            'ä¸ƒæœˆ': { en: 'July', id: 'Juli' }, 'å…«æœˆ': { en: 'August', id: 'Agustus' }, 'ä¹æœˆ': { en: 'September', id: 'September' },
            'åæœˆ': { en: 'October', id: 'Oktober' }, 'åä¸€æœˆ': { en: 'November', id: 'November' }, 'åäºŒæœˆ': { en: 'December', id: 'Desember' },
            'å»£æ±è©±': { en: 'Cantonese', id: 'Kantonis' }, 'è‹±æ–‡': { en: 'English', id: 'Inggris' }, 'æ™®é€šè©±': { en: 'Mandarin', id: 'Mandarin' },
            'è‹±æ–‡&å»£æ±è©±': { en: 'English & Cantonese', id: 'Inggris & Kantonis' }, 'è‹±æ–‡&æ™®é€šè©±': { en: 'English & Mandarin', id: 'Inggris & Mandarin' },
            'å°ç‹—': { en: 'Small Dog', id: 'Anjing Kecil' }, 'ä¸­ç‹—': { en: 'Medium Dog', id: 'Anjing Sedang' }, 'å¤§ç‹—': { en: 'Big Dog', id: 'Anjing Besar' },
            'è²“': { en: 'Cat', id: 'Kucing' }, 'å…”': { en: 'Rabbit', id: 'Kelinci' },
            'é¸šéµ¡': { en: 'Parrot', id: 'Burung Beo' }, 'çƒé¾œ': { en: 'Turtle', id: 'Kura-kura' },
            'å…¶ä»–': { en: 'Other', id: 'Lainnya' }, 'æ²’æœ‰å¯µç‰©': { en: 'No Pets', id: 'Tidak ada hewan peliharaan' }
        };

        // Form Manager Class to handle multiple forms (Input vs Edit)
        class FormManager {
            constructor(containerId, isEdit = false) {
                this.container = document.getElementById(containerId);
                const template = document.getElementById('form-template');
                this.container.appendChild(template.content.cloneNode(true));
                this.form = this.container.querySelector('form');
                this.isEdit = isEdit;
                this.members = [];
                this.pets = [];
                this.initListeners();
            }

            initListeners() {
                // Initialize Tags
                const tagCont = this.form.querySelector('.tags-container');
                tagCont.innerHTML = tagList.map(t => {
                    const id = `tag-${Math.random().toString(36).substr(2, 9)}`;
                    return `
                        <div class="mb-2">
                            <input type="checkbox" id="${id}" value="${t}" class="hidden tag-checkbox">
                            <label for="${id}" class="bg-white border border-pink-300 text-pink-700 px-4 py-2 rounded cursor-pointer hover:bg-pink-100 select-none">${t}</label>
                        </div>
                    `;
                }).join('');
                
                // Assign unique ID to tag-other-check for label mapping
                const otCheck = this.form.querySelector('.tag-other-check');
                const otLabel = this.form.querySelector('.tag-other-label');
                const uniqueOtId = `tag-other-${Math.random().toString(36).substr(2, 9)}`;
                otCheck.id = uniqueOtId;
                otLabel.setAttribute('for', uniqueOtId);

                // Initialize Overseas Options
                const osCont = this.form.querySelector('.overseas-options');
                osCont.innerHTML = overseasList.map(o => `
                    <label class="inline-flex items-center bg-white border px-4 py-2 rounded cursor-pointer border-blue-200">
                        <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 overseas-check" value="${o}">
                        <span class="ml-2">${o}</span>
                    </label>
                `).join('');

                // Date default
                if(!this.isEdit) this.form.querySelector('.inp-inquiry-date').valueAsDate = new Date();
            }

            reset() {
                this.form.reset();
                this.members = [];
                this.pets = [];
                // Clear hidden edit id as well
                this.form.querySelector('.edit-doc-id').value = '';
                this.updateMemberDisplay();
                this.updatePetDisplay();
                // Reset UI states
                this.form.querySelector('.tag-other-text').classList.add('hidden');
                this.form.querySelector('.inp-room-other').classList.add('hidden');
                this.form.querySelector('.inp-nationality-other').classList.add('hidden');
                this.form.querySelector('.pet-other-group').classList.add('hidden');
                this.form.querySelector('.pet-qty-group').classList.add('hidden');
                this.form.querySelectorAll('.tag-checkbox').forEach(c => c.checked = false);
                this.form.querySelectorAll('.overseas-check').forEach(c => c.checked = false);
                this.form.querySelectorAll('.error-msg').forEach(e => e.classList.remove('visible'));
                this.form.querySelectorAll('.input-error').forEach(e => e.classList.remove('input-error'));
                
                if(!this.isEdit) {
                    this.form.querySelector('.inp-inquiry-date').valueAsDate = new Date();
                }
            }

            updateMemberDisplay() {
                const c = this.form.querySelector('.member-list-display');
                c.innerHTML = this.members.map((m,i)=>`<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded flex items-center gap-2">${m.text} <button type="button" class="text-red-500 font-bold px-1 btn-rm-mem" data-idx="${i}">&times;</button></span>`).join('');
                this.form.querySelector('.inp-members-string').value = this.members.map(m=>m.text).join(', ');
                
                // Add event listeners for remove buttons
                c.querySelectorAll('.btn-rm-mem').forEach(btn => {
                    btn.onclick = () => {
                        this.members.splice(btn.dataset.idx, 1);
                        this.updateMemberDisplay();
                        validateMember(this.form.querySelector('.inp-members-string'));
                    };
                });
            }

            updatePetDisplay() {
                const c = this.form.querySelector('.pet-list-display');
                if(this.pets.length===0) { c.innerHTML='<span class="text-gray-400 italic">å°šæœªæ–°å¢</span>'; this.form.querySelector('.inp-pets-string').value=''; }
                else { 
                    c.innerHTML=this.pets.map((p,i)=>`<span class="bg-green-100 text-green-800 px-3 py-1 rounded flex items-center gap-2">${p.text} <button type="button" class="text-red-500 font-bold px-1 btn-rm-pet" data-idx="${i}">&times;</button></span>`).join(''); 
                    this.form.querySelector('.inp-pets-string').value=this.pets.map(p=>p.text).join(', '); 
                }
                c.querySelectorAll('.btn-rm-pet').forEach(btn => {
                    btn.onclick = () => {
                        this.pets.splice(btn.dataset.idx, 1);
                        this.updatePetDisplay();
                        validatePet(this.form.querySelector('.inp-pets-string'));
                    };
                });
            }
        }

        let mainForm, editForm;

        window.initApp = async function() {
            document.getElementById('loading-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);

            // Initialize Forms
            mainForm = new FormManager('form-container-main', false);
            editForm = new FormManager('form-container-edit', true);

            // Initialize Data from 2 Collections
            if (window.isFirebaseMode && window.db) {
                // Collection 1: Employers List (E)
                const q1 = window.query(window.collection(window.db, "Employers List"));
                window.onSnapshot(q1, (snapshot) => {
                    employers = [];
                    snapshot.forEach((doc) => employers.push({ ...doc.data(), docId: doc.id }));
                    employers.sort((a, b) => a.id.localeCompare(b.id));
                    refreshCurrentView();
                });

                // Collection 2: Fishing List (U)
                const q2 = window.query(window.collection(window.db, "Fishing List"));
                window.onSnapshot(q2, (snapshot) => {
                    fishingData = [];
                    snapshot.forEach((doc) => fishingData.push({ ...doc.data(), docId: doc.id }));
                    fishingData.sort((a, b) => a.id.localeCompare(b.id));
                    refreshCurrentView();
                });
            } else {
                const data = localStorage.getItem(LOCAL_STORAGE_KEY); // Fallback offline
                if (data) {
                    const all = JSON.parse(data);
                    employers = all.filter(e => !e.id.startsWith('U'));
                    fishingData = all.filter(e => e.id.startsWith('U'));
                }
                refreshCurrentView();
            }
            switchTab('admin'); 
            switchAdminSub('list'); 
        };

        function getAllEmployers() {
            return [...employers, ...fishingData].sort((a, b) => a.id.localeCompare(b.id));
        }

        function refreshCurrentView() {
            if(!document.getElementById('admin-list-area').classList.contains('hidden')) renderAdminList();
            if(!document.getElementById('page-public').classList.contains('hidden')) renderPublicList();
        }

        function getNextId(prefix) {
            let max = 0;
            const targetList = prefix === 'E' ? employers : fishingData;
            
            targetList.forEach(e => {
                if (e.id && e.id.toUpperCase().startsWith(prefix)) {
                    const numPart = parseInt(e.id.substring(1));
                    if (!isNaN(numPart) && numPart > max) max = numPart;
                }
            });
            
            if (max === 0) {
                if (prefix === 'E') max = 2804;
                if (prefix === 'U') max = 1000;
            }
            
            return prefix + (max + 1);
        }

        // --- UI Logic Helpers ---
        window.toggleTagOther = function(el) {
            const form = el.closest('form');
            const inp = form.querySelector('.tag-other-text');
            const err = form.querySelector('.tag-other-error');
            if(el.checked) inp.classList.remove('hidden'); else { inp.classList.add('hidden'); err.classList.remove('visible'); }
        }

        window.togglePetInputs = function(el) {
            const form = el.closest('form');
            const type = el.value;
            const qtyGroup = form.querySelector('.pet-qty-group');
            const otherGroup = form.querySelector('.pet-other-group');
            qtyGroup.classList.add('hidden'); otherGroup.classList.add('hidden');
            if(type === 'å…¶ä»–') { otherGroup.classList.remove('hidden'); qtyGroup.classList.remove('hidden'); }
            else if(type !== 'æ²’æœ‰å¯µç‰©' && type !== '') { qtyGroup.classList.remove('hidden'); }
        }

        window.toggleAgeInput = function(el) {
            const form = el.closest('form');
            const type = el.value;
            const group = form.querySelector('.age-input-group');
            if(type === 'æˆäºº') group.classList.add('hidden'); else group.classList.remove('hidden');
        }

        window.toggleRoomOther = function(el) { const form = el.closest('form'); if(el.value==='å…¶ä»–') form.querySelector('.inp-room-other').classList.remove('hidden'); else form.querySelector('.inp-room-other').classList.add('hidden'); }
        window.toggleNatOther = function(el) { const form = el.closest('form'); if(el.value==='Other') form.querySelector('.inp-nationality-other').classList.remove('hidden'); else form.querySelector('.inp-nationality-other').classList.add('hidden'); }

        window.adjPet = function(btn, v) { 
            const form = btn.closest('form');
            let el=form.querySelector('.pet-add-qty'); 
            let n=parseInt(el.value)+v; if(n<1)n=1; el.value=n; 
        }

        window.adjustSalary = function(btn, val) { 
            const form = btn.closest('form');
            let el = form.querySelector('.inp-salary'); 
            let v = parseInt(el.value); if(isNaN(v)) v = 5100; v += val; if(v < 5100) v = 5100; el.value = v; 
            validate(el); 
        }

        window.addMember = function(btn) {
            const form = btn.closest('form');
            const mgr = form === mainForm.form ? mainForm : editForm;
            const type = form.querySelector('.mem-type').value;
            const age = form.querySelector('.mem-age').value;
            
            if(type !== 'æˆäºº' && !age) { alert('è«‹è¼¸å…¥å¹´é½¡'); return; }
            
            let text = "";
            if(type === 'æˆäºº') text = "1æˆäºº";
            else if (type === 'é›™èƒèƒ') text = `1é›™èƒèƒ(${age}æ­²)`; 
            else if (type === 'ä¸‰èƒèƒ') text = `1ä¸‰èƒèƒ(${age}æ­²)`;
            else text = `1${type}(${age}æ­²)`;
            
            mgr.members.push({text});
            mgr.updateMemberDisplay();
            form.querySelector('.mem-age').value='';
            validateMember(form.querySelector('.inp-members-string'));
        }

        window.addPetToList = function(btn) {
            const form = btn.closest('form');
            const mgr = form === mainForm.form ? mainForm : editForm;
            const type = form.querySelector('.pet-add-type').value;
            const qty = form.querySelector('.pet-add-qty').value;
            
            if (!type) { alert('è«‹é¸æ“‡å¯µç‰©é¡å‹'); return; }
            if (type === 'æ²’æœ‰å¯µç‰©') { mgr.pets = [{text: 'æ²’æœ‰å¯µç‰©'}]; } 
            else {
                if(mgr.pets.length===1 && mgr.pets[0].text==='æ²’æœ‰å¯µç‰©') mgr.pets=[];
                if(type === 'å…¶ä»–') {
                    const ot = form.querySelector('.inp-pets-other-text').value;
                    if(!ot) { alert('è«‹å¡«å¯«å¯µç‰©é¡å‹'); return; }
                    mgr.pets.push({text: `${qty}${ot}`});
                    form.querySelector('.inp-pets-other-text').value='';
                } else { mgr.pets.push({text: `${qty}${type}`}); }
            }
            mgr.updatePetDisplay();
            validatePet(form.querySelector('.inp-pets-string'));
        }

        // --- Validation ---
        window.validate = function(el) {
            if(document.getElementById('fishing-header').classList.contains('hidden') === false) { return; } // No strict validation in fishing
            const form = el.closest('form');
            const idVal = form.querySelector('.inp-id').value.trim();
            const isU = idVal.toUpperCase().startsWith('U');
            
            if (isU && el.closest('.input-only-field')) {
                el.classList.remove('input-error'); 
                const err = el.parentElement.querySelector('.error-msg');
                if(err) err.classList.remove('visible');
                return;
            }
            const err = el.parentElement.querySelector('.error-msg');
            if(!el.value) { el.classList.add('input-error'); if(err) err.classList.add('visible'); } 
            else { el.classList.remove('input-error'); if(err) err.classList.remove('visible'); }
        }
        window.validateMember = function(el) { if(!document.getElementById('fishing-header').classList.contains('hidden')) return; const err = el.closest('form').querySelector('.member-error'); if(!el.value) err.classList.add('visible'); else err.classList.remove('visible'); }
        window.validatePet = function(el) { if(!document.getElementById('fishing-header').classList.contains('hidden')) return; const err = el.closest('form').querySelector('.pet-error'); if(!el.value) err.classList.add('visible'); else err.classList.remove('visible'); }
        window.validateTagOther = function(el) { if(!document.getElementById('fishing-header').classList.contains('hidden')) return; const chk = el.closest('form').querySelector('.tag-other-check'); const err = el.closest('form').querySelector('.tag-other-error'); if(chk.checked && !el.value) { el.classList.add('input-error'); err.classList.add('visible'); } else { el.classList.remove('input-error'); err.classList.remove('visible'); } }
        window.validateOther = function(el, selectClass) { const sel = el.closest('form').querySelector(selectClass); const err = el.parentElement.querySelector('.error-msg'); if(sel.value.includes('å…¶ä»–') || sel.value.includes('Other')) { if(!el.value) { el.classList.add('input-error'); if(err) err.classList.add('visible'); } else { el.classList.remove('input-error'); if(err) err.classList.remove('visible'); } } }
        window.validateOverseas = function(form) {
            if(!document.getElementById('fishing-header').classList.contains('hidden')) return true;
            const idVal = form.querySelector('.inp-id').value.trim();
            if (idVal.toUpperCase().startsWith('U')) return true;
            const chks = form.querySelectorAll('.overseas-check:checked');
            const err = form.querySelector('.overseas-error');
            if(chks.length === 0) { err.classList.add('visible'); return false; }
            else { err.classList.remove('visible'); return true; }
        }

        // --- Main Functions ---
        window.logout = function() {
            if(confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                sessionStorage.removeItem('isAdminLoggedIn');
                location.reload();
            }
        };

        window.clearInputForm = function(type) {
            if(!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¡«å¯«å…§å®¹å—ï¼Ÿ")) return;
            mainForm.reset();
            // Reset ID based on mode
            if(document.getElementById('fishing-header').classList.contains('hidden')) {
                 mainForm.form.querySelector('.inp-id').value = getNextId('E');
            } else {
                 mainForm.form.querySelector('.inp-id').value = getNextId('U');
            }
        }
        
        window.closeEditMode = function() {
            if(confirm("ç¢ºå®šå–æ¶ˆä¿®æ”¹ï¼Ÿæœªå„²å­˜çš„è³‡æ–™å°‡æœƒéºå¤±ã€‚")) {
                switchAdminSub('list');
            }
        }

        window.handleSave = async function(btn) {
            const form = btn.closest('form');
            const mgr = form === mainForm.form ? mainForm : editForm;
            
            const btnTextSpan = btn.querySelector('.btn-save-text');
            const orgText = btnTextSpan.innerText;
            
            const isFishingMode = !document.getElementById('fishing-header').classList.contains('hidden') && mgr === mainForm;
            
            try {
                const id = form.querySelector('.inp-id').value.toUpperCase();
                const loc = form.querySelector('.inp-location').value;
                let nat = form.querySelector('.inp-nationality').value; if(nat === 'Other') nat = form.querySelector('.inp-nationality-other').value;
                const memStr = form.querySelector('.inp-members-string').value;
                const petStr = form.querySelector('.inp-pets-string').value;
                let room = form.querySelector('.inp-room').value; if(room === 'å…¶ä»–') room = form.querySelector('.inp-room-other').value;
                const date = form.querySelector('.inp-date').value;
                const salary = form.querySelector('.inp-salary').value;
                const lang = form.querySelector('.inp-lang').value;
                const remarks = form.querySelector('.inp-remarks').value;

                let tags = [];
                form.querySelectorAll('.tag-checkbox:checked').forEach(c => tags.push(c.value));
                if(form.querySelector('.tag-other-check').checked) { const ot = form.querySelector('.tag-other-text').value; if(ot) tags.push(ot); }
                const tagStr = tags.join(', ');

                let overseasStr="", flatSize="", empReq="", empName="", empLang="", empPhone="", inqDate="", referrer="";
                const isU = id.startsWith('U');

                // NEW VALIDATION LOGIC FOR MANDATORY FIELDS (ONLY FOR NON-FISHING)
                if (!isFishingMode) {
                    let isValid = true;

                    // 1. Common Mandatory Fields
                    ['.inp-id', '.inp-location', '.inp-nationality', '.inp-room', '.inp-date', '.inp-salary', '.inp-lang'].forEach(sel => {
                        const el = form.querySelector(sel);
                        validate(el); // Toggles error visual
                        if(!el.value) isValid = false;
                    });

                    // 2. Members
                    validateMember(form.querySelector('.inp-members-string'));
                    if(!memStr) isValid = false;

                    // 3. Pets
                    validatePet(form.querySelector('.inp-pets-string'));
                    if(!petStr) isValid = false;

                    // 4. Internal Fields (Only if not U)
                    if(!isU) {
                         ['.inp-flat-size', '.inp-emp-name', '.inp-emp-lang', '.inp-emp-phone', '.inp-inquiry-date', '.inp-referrer'].forEach(sel => {
                            const el = form.querySelector(sel);
                            validate(el);
                            if(!el.value) isValid = false;
                         });
                         
                         let overseasArr = [];
                         form.querySelectorAll('.overseas-check:checked').forEach(c => overseasArr.push(c.value));
                         overseasStr = overseasArr.join(', ');
                         
                         if(!validateOverseas(form)) isValid = false;
                    } else {
                        // For U, these might be empty, but assign empty strings
                    }

                    // 5. Check "Other" inputs
                    // Nationality Other
                    if(form.querySelector('.inp-nationality').value === 'Other' && !form.querySelector('.inp-nationality-other').value) {
                        validateOther(form.querySelector('.inp-nationality-other'), '.inp-nationality');
                        isValid = false;
                    }
                    // Room Other
                    if(form.querySelector('.inp-room').value === 'å…¶ä»–' && !form.querySelector('.inp-room-other').value) {
                        validateOther(form.querySelector('.inp-room-other'), '.inp-room');
                        isValid = false;
                    }

                    if(!isValid) {
                        return; // STOP HERE, errors are already shown on screen
                    }
                }

                // Proceed with upload
                btn.disabled = true; btnTextSpan.innerText = "è™•ç†ä¸­...";

                if (parseInt(salary) < 5100) { alert('è–ªé‡‘éŒ¯èª¤ï¼Œé‡æ–°å¡«å¯«'); throw new Error('è–ªé‡‘éŒ¯èª¤'); }

                const dataObj = {
                    id, location: loc, nationality: nat, members: memStr, pets: petStr, room, date, salary, lang, remarks,
                    tags: tagStr,
                    overseas_local: overseasStr,
                    flat_size: flatSize,
                    emp_req: empReq,
                    emp_name: empName,
                    emp_lang: empLang,
                    emp_phone: empPhone,
                    inq_date: inqDate,
                    referrer: referrer,
                    active: true,
                    updated_at: new Date().toISOString()
                };

                const docId = form.querySelector('.edit-doc-id').value;
                const collectionName = isU ? "Fishing List" : "Employers List";

                if (window.isFirebaseMode) {
                    if (docId && mgr === editForm) {
                        // Update
                        await window.updateDoc(window.doc(window.db, collectionName, docId), dataObj);
                    } else {
                        // Create NEW: use setDoc with ID as key
                        await window.setDoc(window.doc(window.db, collectionName, id), dataObj);
                    }
                } else {
                    // Offline Fallback
                    if (docId && mgr === editForm) {
                        // Find and update in appropriate array
                        const targetArr = isU ? fishingData : employers;
                        const idx = targetArr.findIndex(e => e.docId === docId);
                        if(idx !== -1) targetArr[idx] = { ...dataObj, docId };
                    } else {
                        dataObj.docId = String(Date.now());
                        if(isU) fishingData.push(dataObj); else employers.push(dataObj);
                    }
                    const allData = [...employers, ...fishingData];
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allData));
                    refreshCurrentView();
                }

                // Sync to Google Sheets
                if (window.GOOGLE_SCRIPT_URL) { 
                    sendToGoogleSheets(dataObj, isU ? 'Fishing' : 'Employers'); 
                }

                alert(mgr === editForm ? 'è³‡æ–™å·²æ›´æ”¹åŠä¸Šæ¶' : 'ä¸Šè¼‰æˆåŠŸåŠå·²ä¸Šæ¶');

                if (mgr === mainForm) {
                    // If we just uploaded a fishing data, don't clear fully, just regen
                    if(isFishingMode) {
                         generateFishingData();
                    } else {
                         mainForm.reset();
                         form.querySelector('.inp-id').value = getNextId('E');
                    }
                }
                
                // If edit mode, close it
                if (mgr === editForm) {
                    switchAdminSub('list');
                }

            } catch (e) {
                if(!e.message.includes('è–ªé‡‘éŒ¯èª¤')) alert(e.message);
            } finally {
                btn.disabled = false; btnTextSpan.innerText = orgText;
            }
        };

        async function sendToGoogleSheets(data, sheetType) {
            // Mapping keys to Chinese headers for Google Sheet
            const mapping = {
                id: "åƒ±ä¸»ç·¨è™Ÿ", location: "åƒ±ä¸»åœ°å€", nationality: "åœ‹ç±", members: "å®¶åº­æˆå“¡", pets: "å¯µç‰©",
                room: "å·¥äººæˆ¿", date: "ä¸Šç­æ—¥æœŸ", salary: "è–ªé‡‘", lang: "èªè¨€", remarks: "å‚™è¨»", tags: "æ¨™ç±¤",
                flat_size: "å–®ä½å‘æ•¸", overseas_local: "è˜è«‹é¡åˆ¥", emp_req: "åƒ±ä¸»è¦æ±‚", emp_name: "åƒ±ä¸»å§“å",
                emp_lang: "åƒ±ä¸»èªè¨€", emp_phone: "åƒ±ä¸»é›»è©±", inq_date: "æŸ¥è©¢æ—¥æœŸ", referrer: "ä»‹ç´¹äºº", updated_at: "æ›´æ–°æ™‚é–“"
            };

            const payload = { sheetType: sheetType }; // Tell App Script which sheet
            for (let key in data) {
                if(mapping[key]) payload[mapping[key]] = data[key];
                else payload[key] = data[key];
            }

            try {
                await fetch(window.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                console.log('Sent to Sheets backup');
            } catch (e) {
                console.error('Sheet Error', e);
            }
        }

        window.toggleActive = async function(docId, currentStatus, idStr) {
            const isU = idStr.startsWith('U');
            const collectionName = isU ? "Fishing List" : "Employers List";
            if (window.isFirebaseMode) { 
                await window.updateDoc(window.doc(window.db, collectionName, docId), { active: !currentStatus }); 
            } else { 
                const arr = isU ? fishingData : employers;
                const emp = arr.find(e => e.docId === docId); 
                if(emp) { emp.active = !currentStatus; localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify([...employers, ...fishingData])); refreshCurrentView(); } 
            }
        };

        window.deleteEmp = async function(docId, idStr) {
            if(!confirm('ç¢ºèªåˆªé™¤ï¼Ÿé€™å°‡æ°¸ä¹…ç§»é™¤è³‡æ–™ã€‚')) return; 
            const isU = idStr.startsWith('U');
            const collectionName = isU ? "Fishing List" : "Employers List";
            
            if(window.isFirebaseMode) { 
                await window.deleteDoc(window.doc(window.db, collectionName, docId)); 
            } else { 
                const arr = isU ? fishingData : employers;
                const idx = arr.findIndex(e => e.docId === docId); 
                if(idx > -1) { arr.splice(idx, 1); localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify([...employers, ...fishingData])); refreshCurrentView(); } 
            }
        };

        window.editEmp = function(docId) {
            const all = getAllEmployers();
            const e = all.find(emp => emp.docId === docId);
            if(!e) return;
            
            const form = editForm.form;
            editForm.reset();
            
            form.querySelector('.inp-id').value = e.id;
            form.querySelector('.inp-location').value = e.location;
            
            const stdNat = ['Filipino','Indonesian','Filipino & Indonesian','Indonesian & Filipino'];
            if(stdNat.includes(e.nationality)) { form.querySelector('.inp-nationality').value = e.nationality; toggleNatOther(form.querySelector('.inp-nationality')); }
            else { form.querySelector('.inp-nationality').value = 'Other'; toggleNatOther(form.querySelector('.inp-nationality')); form.querySelector('.inp-nationality-other').value = e.nationality; }
            
            form.querySelector('.inp-room').value = e.room; 
            if(e.room && !['æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','èˆ‡å°å­©åŒæˆ¿','èˆ‡é•·è€…åŒæˆ¿','èˆ‡å¦å¤–å‚­åŒæˆ¿','èˆ‡å¥³åƒ±ä¸»åŒæˆ¿'].includes(e.room)){
                 form.querySelector('.inp-room').value = 'å…¶ä»–'; toggleRoomOther(form.querySelector('.inp-room')); form.querySelector('.inp-room-other').value = e.room;
            }
            form.querySelector('.inp-date').value = e.date;
            form.querySelector('.inp-salary').value = e.salary;
            form.querySelector('.inp-lang').value = e.lang;
            form.querySelector('.inp-remarks').value = e.remarks || '';
            
            // Internal
            form.querySelector('.inp-flat-size').value = e.flat_size || '';
            form.querySelector('.inp-emp-req').value = e.emp_req || '';
            form.querySelector('.inp-emp-name').value = e.emp_name || '';
            form.querySelector('.inp-emp-lang').value = e.emp_lang || '';
            form.querySelector('.inp-emp-phone').value = e.emp_phone || '';
            form.querySelector('.inp-inquiry-date').value = e.inq_date || e.inquiry_date || '';
            form.querySelector('.inp-referrer').value = e.referrer || '';
            
            if(e.overseas_local) {
                const os = e.overseas_local.split(', ');
                form.querySelectorAll('.overseas-check').forEach(c => c.checked = os.includes(c.value));
            }

            const ts = (e.tags || '').split(', ');
            form.querySelectorAll('.tag-checkbox').forEach(c => c.checked = ts.includes(c.value));
            
            // Check for custom tags in edit
            const stdTags = tagList;
            const customTag = ts.find(t => !stdTags.includes(t) && t.trim() !== '');
            if(customTag) {
                form.querySelector('.tag-other-check').checked = true;
                form.querySelector('.tag-other-text').value = customTag;
                toggleTagOther(form.querySelector('.tag-other-check'));
            }

            form.querySelector('.edit-doc-id').value = docId;
            
            // Rebuild members
            editForm.members = []; 
            if(e.members) e.members.split(', ').forEach(p => editForm.members.push({text: p})); 
            editForm.updateMemberDisplay();
            
            // Rebuild pets
            editForm.pets = []; 
            if(e.pets) e.pets.split(', ').forEach(p => editForm.pets.push({text: p})); 
            editForm.updatePetDisplay();
            
            // Switch to Edit Mode (Separate Tab)
            switchAdminSub('edit');
            window.scrollTo(0,0);
        };

        window.switchTab = function(tab) {
            document.getElementById('page-login').classList.add('hidden-section');
            document.getElementById('page-admin').classList.add('hidden-section');
            document.getElementById('page-public').classList.add('hidden-section');
            document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + tab).classList.add('active');
            
            // Badge Logic
            const badge = document.getElementById('mode-badge');
            if (tab === 'admin') badge.classList.remove('hidden'); else badge.classList.add('hidden');

            if (tab === 'admin') {
                if (sessionStorage.getItem('isAdminLoggedIn') === 'true') { document.getElementById('page-admin').classList.remove('hidden-section'); switchAdminSub('list'); }
                else { document.getElementById('page-login').classList.remove('hidden-section'); }
            } else {
                document.getElementById('page-public').classList.remove('hidden-section');
                currentLang = tab; currentPage = 1; renderPublicList();
            }
        };
        window.checkLogin = function() {
            if (document.getElementById('admin-password').value === PASSWORD) { sessionStorage.setItem('isAdminLoggedIn', 'true'); document.getElementById('login-error').classList.add('hidden'); document.getElementById('admin-password').value = ''; switchTab('admin'); }
            else { document.getElementById('login-error').classList.remove('hidden'); }
        };
        
        window.switchAdminSub = function(sub) {
            document.getElementById('admin-input-area').classList.add('hidden');
            document.getElementById('admin-list-area').classList.add('hidden');
            document.getElementById('admin-edit-area').classList.add('hidden');
            document.getElementById('fishing-header').classList.add('hidden');
            document.getElementById('fishing-footer').classList.add('hidden');
            document.getElementById('clear-btn-container').classList.add('hidden');

            // Reset Input Fields Visibility
            document.querySelectorAll('.input-only-field').forEach(f => f.classList.remove('hidden')); 
            
            // Button Styles (Reset all rings)
            const btnInput = document.getElementById('sub-btn-input');
            const btnFishing = document.getElementById('sub-btn-fishing');
            const btnList = document.getElementById('sub-btn-list');
            const btnEdit = document.getElementById('sub-btn-edit');
            
            [btnInput, btnFishing, btnList, btnEdit].forEach(b => {
                b.classList.remove('ring-4', 'ring-red-700'); // Removed specific color rings, using red-700 for all
            });
            btnEdit.classList.add('hidden'); 

            if (sub === 'input') {
                document.getElementById('admin-input-area').classList.remove('hidden');
                document.getElementById('clear-btn-container').classList.remove('hidden');
                
                // Deep red ring for active
                btnInput.classList.add('ring-4', 'ring-red-700');
                
                // FORCE RESET: Ensure fishing data is gone and ID is E-based
                mainForm.reset();
                mainForm.form.querySelector('.label-id').innerText = "åƒ±ä¸»ç·¨è™Ÿ (ç·¨è™Ÿä»¥Eé–‹å§‹ï¼Œä¾‹å¦‚ï¼šE2805)";
                mainForm.form.querySelector('.inp-id').value = getNextId('E');
            }
            else if (sub === 'fishing') {
                document.getElementById('admin-input-area').classList.remove('hidden');
                document.getElementById('fishing-header').classList.remove('hidden');
                document.getElementById('fishing-footer').classList.remove('hidden');
                
                btnFishing.classList.add('ring-4', 'ring-red-700');
                
                // Hide internal fields
                document.querySelectorAll('.input-only-field').forEach(f => f.classList.add('hidden')); 
                
                // Label Change
                mainForm.form.querySelector('.label-id').innerText = "åƒ±ä¸»ç·¨è™Ÿ (ç·¨è™Ÿä»¥Ué–‹å§‹ï¼Œä¾‹å¦‚ï¼šU1001)";
                
                generateFishingData();
            }
            else if (sub === 'list') {
                document.getElementById('admin-list-area').classList.remove('hidden');
                btnList.classList.add('ring-4', 'ring-red-700');
                currentAdminPage = 1;
                renderAdminList();
            }
            else if (sub === 'edit') {
                 document.getElementById('admin-edit-area').classList.remove('hidden');
                 btnEdit.classList.remove('hidden');
                 btnEdit.classList.add('ring-4', 'ring-red-700');
            }
            
            currentAdminSub = sub;
        };

        window.generateFishingData = function() {
            mainForm.reset();
            const form = mainForm.form;
            
            // 1. ID
            form.querySelector('.inp-id').value = getNextId('U');
            
            // 2. Location
            const st = Object.keys(locationMap); 
            form.querySelector('.inp-location').value = st[Math.floor(Math.random()*st.length)];
            
            // 3. Nationality
            const nats = ['Filipino', 'Indonesian', 'Filipino & Indonesian', 'Indonesian & Filipino'];
            form.querySelector('.inp-nationality').value = nats[Math.floor(Math.random()*nats.length)]; 
            toggleNatOther(form.querySelector('.inp-nationality'));

            // 4. Members (Revised Logic)
            mainForm.members = [];
            // Probability: 2A 1C (High), then others.
            // Constraint: Total 1-4. Max 2A, Max 2C.
            
            const r = Math.random();
            let nAdult, nChild;
            
            if (r < 0.4) { nAdult = 2; nChild = 1; } // 40% chance for 2A 1C
            else if (r < 0.6) { nAdult = 2; nChild = 2; }
            else if (r < 0.7) { nAdult = 2; nChild = 0; }
            else if (r < 0.8) { nAdult = 1; nChild = 0; }
            else if (r < 0.9) { nAdult = 1; nChild = 1; }
            else { nAdult = 1; nChild = 2; }
            
            if (nAdult > 0) {
                // Merge Adults: "2æˆäºº" or "1æˆäºº"
                mainForm.members.push({text: `${nAdult}æˆäºº`});
            }
            
            if (nChild > 0) {
                // Separate Children with Ages 0-17
                for(let i=0; i<nChild; i++) {
                    const age = Math.floor(Math.random() * 18); // 0-17
                    mainForm.members.push({text: `1å°å­©(${age}æ­²)`});
                }
            }
            
            mainForm.updateMemberDisplay();

            // 5. Pets (Revised Logic)
            mainForm.pets = [];
            // "No Pets" highest probability. Max 2 qty.
            const pr = Math.random();
            if (pr < 0.6) {
                // 60% No pets
                mainForm.pets.push({text: 'æ²’æœ‰å¯µç‰©'});
            } else {
                // Generate 1 type, 1-2 qty
                const pTypes = ['å°ç‹—', 'ä¸­ç‹—', 'å¤§ç‹—', 'è²“'];
                const pType = pTypes[Math.floor(Math.random()*pTypes.length)];
                const qty = Math.random() > 0.7 ? 2 : 1; // 30% chance of 2
                mainForm.pets.push({text: `${qty}${pType}`});
            }
            mainForm.updatePetDisplay();

            // 6. Room
            const rOpts = ['æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','èˆ‡å°å­©åŒæˆ¿','èˆ‡é•·è€…åŒæˆ¿','èˆ‡å¦å¤–å‚­åŒæˆ¿','èˆ‡å¥³åƒ±ä¸»åŒæˆ¿'];
            form.querySelector('.inp-room').value = rOpts[Math.floor(Math.random()*rOpts.length)]; 
            toggleRoomOther(form.querySelector('.inp-room'));
            
            // 7. Salary & Lang
            const sals = [5100, 5300, 5500, 5500, 5500, 5800, 6000]; 
            form.querySelector('.inp-salary').value = sals[Math.floor(Math.random()*sals.length)];
            const langs = ['è‹±æ–‡','è‹±æ–‡','è‹±æ–‡','å»£æ±è©±','æ™®é€šè©±','è‹±æ–‡&å»£æ±è©±','è‹±æ–‡&æ™®é€šè©±']; 
            form.querySelector('.inp-lang').value = langs[Math.floor(Math.random()*langs.length)];
            
            form.querySelector('.inp-date').value = 'ç›¡å¿«'; 
            form.querySelector('.inp-remarks').value = '';
            
            // 8. Tags (Revised)
            form.querySelectorAll('.tag-checkbox').forEach(c => c.checked = false);
            // Can have no tags, or random subset of allowed tags
            if (Math.random() > 0.3) {
                 const numTags = Math.floor(Math.random() * 3) + 1; // 1 to 3 tags
                 let choices = fishingTags.sort(() => 0.5 - Math.random()).slice(0, numTags);
                 choices.forEach(t => { 
                     // Find checkbox with this value
                     const chk = Array.from(form.querySelectorAll('.tag-checkbox')).find(c => c.value === t);
                     if(chk) chk.checked = true;
                 });
            }
        };

        // --- Render Lists ---

        function renderAdminList() {
            const c = document.getElementById('admin-records-container'); c.innerHTML = '';
            document.getElementById('db-status-text').innerText = window.isFirebaseMode ? "(Firebase Cloud)" : "(Offline)";
            
            const allData = getAllEmployers(); // Combined list
            if(allData.length === 0) { c.innerHTML = '<p class="text-center text-gray-400">æš«ç„¡è³‡æ–™</p>'; return; }

            const totalPages = Math.ceil(allData.length / itemsPerPage);
            const start = (currentAdminPage - 1) * itemsPerPage;
            const pageData = allData.slice(start, start + itemsPerPage);

            document.getElementById('admin-pagination').classList.remove('hidden');
            document.getElementById('admin-page-indicator').innerText = `Page ${currentAdminPage} / ${totalPages || 1}`;

            pageData.forEach((e) => {
                const status = e.active ? '<span class="text-green-600 font-bold">[ä¸Šæ¶ä¸­]</span>' : '<span class="text-red-600 font-bold">[å·²ä¸‹æ¶]</span>';
                const tTags = e.tags ? `<p class="col-span-full"><span class="font-bold">æ¨™ç±¤:</span> ${e.tags}</p>` : '';
                
                const dispMem = formatMembersForDisplay(e.members);
                const dispPet = formatPetsForDisplay(e.pets);

                // Differentiate visually between E and U
                const isU = e.id.startsWith('U');
                const borderColor = isU ? 'border-l-purple-500' : (e.active ? 'border-l-green-500' : 'border-l-red-500');
                const badge = isU ? '<span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded ml-2">é‡£é­šç›¤</span>' : '';

                const html = `
                    <div class="bg-white p-6 rounded-lg shadow border border-l-8 ${borderColor}">
                        <div class="flex flex-col sm:flex-row justify-between items-start mb-4 pb-2 border-b">
                            <h4 class="font-bold text-blue-800 flex items-center">${e.id} ${badge} <span class="ml-2 text-sm">${status}</span></h4>
                            <div class="space-x-2 mt-2 sm:mt-0">
                                <button onclick="editEmp('${e.docId}')" class="bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">ä¿®æ”¹</button>
                                <button onclick="toggleActive('${e.docId}', ${e.active}, '${e.id}')" class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded hover:bg-yellow-200">${e.active ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}</button>
                                <button onclick="deleteEmp('${e.docId}', '${e.id}')" class="bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="text-gray-700">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2">
                                <p><span class="font-bold">æˆå“¡:</span> ${dispMem}</p>
                                <p><span class="font-bold">åœ°å€:</span> ${e.location}</p>
                                <p><span class="font-bold">å¯µç‰©:</span> ${dispPet}</p>
                                <p><span class="font-bold">æˆ¿é–“:</span> ${e.room}</p>
                                <p><span class="font-bold">ä¸Šç­:</span> ${e.date}</p>
                                <p><span class="font-bold">è–ªé‡‘:</span> $${e.salary}</p>
                                <p><span class="font-bold">åœ‹ç±:</span> ${e.nationality||'-'}</p>
                                <p><span class="font-bold">èªè¨€:</span> ${e.lang}</p>
                                <p class="col-span-full"><span class="font-bold">å‚™è¨»:</span> ${e.remarks || '-'}</p>
                                ${tTags}
                            </div>
                            
                            ${!isU ? `
                            <div class="mt-4 p-4 rounded bg-blue-50 border border-blue-200">
                                <p class="font-bold text-blue-600 mb-2">å…§éƒ¨ç´€éŒ„ï¼š</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2">
                                    <p><span class="font-bold">å–®ä½å‘æ•¸:</span> ${e.flat_size||'-'}</p>
                                    <p><span class="font-bold">è˜è«‹é¡åˆ¥:</span> ${e.overseas_local||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»è¦æ±‚:</span> ${e.emp_req||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»å§“å:</span> ${e.emp_name||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»èªè¨€:</span> ${e.emp_lang||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»é›»è©±:</span> ${e.emp_phone||'-'}</p>
                                    <p><span class="font-bold">æŸ¥è©¢æ—¥æœŸ:</span> ${e.inq_date||e.inquiry_date||'-'}</p>
                                    <p><span class="font-bold">ä»‹ç´¹äºº:</span> ${e.referrer||'-'}</p>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>`;
                c.innerHTML += html;
            });
        }

        function renderPublicList() {
            const container = document.getElementById('public-records-container'); container.innerHTML = '';
            // Show ACTIVE employers from BOTH lists
            const allData = getAllEmployers();
            const activeEmps = allData.filter(e => e.active);
            
            const totalPages = Math.ceil(activeEmps.length / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage;
            const pageData = activeEmps.slice(start, start + itemsPerPage);
            const isEn = currentLang === 'english';
            
            // Banner & Translations logic kept same
            const bannerText = document.getElementById('banner-text');
            const footerMsg = document.getElementById('public-footer-msg');
            footerMsg.classList.remove('hidden');

            if(isEn) {
                bannerText.innerHTML = "ğŸ’µ All helpers NO placement fee, NO agency fee, NO registration fee.<br><br>ğŸ’¼ Apply job or refer your friends? Click the green button below to WhatsApp us.<br><br>ğŸ¤ In our agency, you have the Right to choose your next preferred employer, we do not force you to choose, refer your friends and family now.";
                bannerText.style.fontSize = "30px";
                document.getElementById('public-title').innerText = 'Employer List'; 
                document.getElementById('nav-indonesian').innerText = 'ğŸ‡®ğŸ‡© Indonesian';
                document.getElementById('btn-prev').innerText = 'Prev'; document.getElementById('btn-next').innerText = 'Next';
                footerMsg.innerHTML = "If you still havenâ€™t found employer you like, please contact us on WhatsApp, we will help you find one that you like.";
            } else {
                bannerText.innerHTML = "ğŸ’µ Semua pekerja tanpa biaya penempatan, tanpa biaya agen, dan tanpa biaya pendaftaran.<br><br>ğŸ’¼ Ingin melamar kerja atau merekomendasikan teman? Klik tombol hijau di bawah untuk WhatsApp kami.<br><br>ğŸ¤ Di Agen Ketenagakerjaan kami, Anda memiliki hak untuk memilih majikan berikutnya yang Anda inginkan. Kami tidak memaksa Anda untuk memilih. Rekomendasikan teman dan keluarga Anda sekarang.";
                bannerText.style.fontSize = "30px";
                document.getElementById('public-title').innerText = 'Daftar Majikan';
                document.getElementById('nav-indonesian').innerText = 'ğŸ‡®ğŸ‡© Indonesian';
                document.getElementById('btn-prev').innerText = 'Sebelumnya'; document.getElementById('btn-next').innerText = 'Berikutnya';
                footerMsg.innerHTML = "Jika Anda masih belum menemukan majikan yang Anda sukai, silakan hubungi kami melalui WhatsApp. Kami akan membantu Anda menemukan yang sesuai dengan keinginan Anda.";
            }

            if(pageData.length === 0) { container.innerHTML = '<div class="col-span-full text-center p-10 text-gray-500">No Data / Tidak Ada Data</div>'; updatePageIndicator(0, 0, isEn); return; }

            pageData.forEach(e => {
                const tLoc = translateText(e.location, currentLang);
                const tNat = e.nationality; 
                const tMem = translateMembers(e.members, currentLang); 
                const tPet = translatePets(e.pets, currentLang);
                const tRoom = getDict(e.room, currentLang);
                const tDate = getDict(e.date, currentLang);
                const tLang = getDict(e.lang, currentLang);
                let tRem = e.remarks; if (!isEn && e.remarks) tRem = e.remarks.replace(/å¥½åƒ±ä¸»/g, 'Majikan Baik').replace(/æº–æ™‚å‡ºç³§/g, 'Gaji Tepat Waktu');

                let tagHtml = '';
                if(e.tags) {
                    const tagArr = e.tags.split(', ');
                    tagHtml = '<div class="mb-4 flex flex-wrap gap-2">';
                    tagArr.forEach(t => {
                        let label = t;
                        if(isEn) {
                            const match = t.match(/^\d+[\u4e00-\u9fa5]+ (.+)$/);
                            if(match) label = match[1];
                            else {
                                const genMatch = t.match(/[\u4e00-\u9fa5]+ (.+)$/);
                                if(genMatch) label = genMatch[1];
                            }
                        } else {
                            label = tagMapIndo[t] || t;
                        }
                        tagHtml += `<span class="bg-pink-100 text-pink-800 border border-pink-200 px-3 py-1 rounded font-bold">${label}</span>`;
                    });
                    tagHtml += '</div>';
                }

                const idD = isEn ? `Employer Number: ${e.id}` : `Nomor Majikan: ${e.id}`;
                const salD = isEn ? `Salary` : `Gaji`;
                const petClass = (tPet.includes('No Pets') || tPet.includes('Tidak ada hewan')) ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const roomClass = (tRoom.includes('have own room') || tRoom.includes('ada kamar sendiri')) ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const dateClass = (tDate === 'ASAP' || tDate === 'Secepatnya') ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const waMsg = isEn ? `I'm interested in this Employer: ${e.id}` : `Saya tertarik dengan majikan ini (I'm interested in this Employer: ${e.id})`;
                const waBtnText = isEn ? "I'm interested in this Employer" : "Saya tertarik dengan majikan ini";
                const waLink = `https://wa.me/85296111003?text=${encodeURIComponent(waMsg)}`;

                const L = { loc: isEn ? 'Employer Location' : 'Lokasi Majikan', nat: isEn ? 'Nationality' : 'kebangsaan', fam: isEn ? 'Employer Member & Age' : 'Anggota Keluarga & Usia', pets: isEn ? 'Pets' : 'Hewan Peliharaan', room: isEn ? 'Helper Room' : 'Kamar Pembantu', date: isEn ? 'START of WORK DAY' : 'Mulai Hari Kerja', lang: isEn ? 'Language' : 'Bahasa', rem: isEn ? 'Remarks' : 'Catatan' };

                const html = `
                    <div class="bg-white rounded-xl shadow-xl border-t-8 border-blue-600 overflow-hidden flex flex-col p-8 space-y-5">
                        ${tagHtml}
                        <div class="flex flex-col border-b pb-4 mb-2">
                            <h3 class="font-bold text-gray-900">${idD}</h3>
                        </div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.nat}</p><p class="font-medium text-gray-800 text-3xl">${tNat}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.lang}</p><p class="font-medium text-blue-800 text-3xl">${tLang}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.fam}</p><p class="font-medium text-gray-800 text-3xl">${tMem}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.loc}</p><p class="font-medium text-gray-800 text-3xl">${tLoc}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.pets}</p><p class="${petClass} text-3xl">${tPet}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.room}</p><p class="${roomClass} text-3xl">${tRoom}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.date}</p><p class="${dateClass} text-3xl">${tDate}</p></div>
                        <div>
                            <p class="text-gray-400 font-bold uppercase tracking-wide">${salD}</p>
                            <p class="font-bold text-black text-3xl">$${e.salary}</p>
                        </div>
                        ${e.remarks ? `<div class="bg-yellow-50 p-4 rounded border border-yellow-100"><p class="text-gray-700 font-bold uppercase">${L.rem}</p><p class="text-gray-700 italic text-xl">${tRem}</p></div>` : ''}
                        
                        <a href="${waLink}" target="_blank" class="block w-full text-center bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl mt-6 shadow transition text-3xl">
                            <i class="fa-brands fa-whatsapp mr-2"></i> ${waBtnText}
                        </a>
                    </div>
                `;
                container.innerHTML += html;
            });
            updatePageIndicator(currentPage, totalPages, isEn);
        }

        function updatePageIndicator(curr, total, isEn) { document.getElementById('page-indicator').innerText = `${isEn ? 'Page' : 'Halaman'} ${curr} / ${total || 1}`; }
        
        // Helper formatting functions
        function formatMembersForDisplay(text) {
            if(!text) return '-';
            const parts = text.split(', ');
            let adultCount = 0; let others = [];
            parts.forEach(p => { if(p.includes('æˆäºº')) { const match = p.match(/(\d+)æˆäºº/); if(match) adultCount += parseInt(match[1]); else adultCount += 1; } else { others.push(p); } });
            let res = []; if(adultCount > 0) res.push(`${adultCount}æˆäºº`); res = res.concat(others); return res.join(', ');
        }
        function formatPetsForDisplay(text) {
            if(!text) return '-'; if(text === 'æ²’æœ‰å¯µç‰©') return text;
            const parts = text.split(', '); const petCounts = {}; const targetTypes = ['å°ç‹—','ä¸­ç‹—','å¤§ç‹—','è²“','å…”','é¸šéµ¡','çƒé¾œ']; let others = [];
            parts.forEach(p => { let matched = false; for(let t of targetTypes) { if(p.includes(t)) { const match = p.match(/^(\d+)(.+)$/); if(match && match[2] === t) { petCounts[t] = (petCounts[t] || 0) + parseInt(match[1]); matched = true; break; } } } if(!matched) others.push(p); });
            let res = []; for(let t in petCounts) { res.push(`${petCounts[t]}${t}`); } return res.concat(others).join(', ');
        }
        function translateText(text, lang) { if(!text) return '-'; let res = text; for(let cn in locationMap) { if(res.includes(cn)) res = res.replace(cn, locationMap[cn]); } return res; }
        function translateMembers(text, lang) {
            if(!text) return '-'; const parts = text.split(', '); let adultCount = 0; let otherParts = [];
            parts.forEach(p => { if(p.includes('æˆäºº')) { const match = p.match(/(\d+)æˆäºº/); if(match) adultCount += parseInt(match[1]); else adultCount += 1; } else { otherParts.push(p); } });
            let translatedOthers = otherParts.map(p => { let res = p; if(lang === 'english') { res = res.replace(/å°å­©/g, ' Kid').replace(/é•·è€…/g, ' Elderly').replace(/ç”·å­©/g, ' Boy').replace(/å¥³å­©/g, ' Girl').replace(/é›™èƒèƒ/g, ' Twins').replace(/ä¸‰èƒèƒ/g, ' Triplets').replace(/å©†å©†/g, ' Grandma').replace(/å…¬å…¬/g, ' Grandpa').replace(/æ­²/g, 'yo'); } else { res = res.replace(/å°å­©/g, ' Anak').replace(/é•·è€…/g, ' Lansia').replace(/ç”·å­©/g, ' Anak Laki-laki').replace(/å¥³å­©/g, ' Anak Perempuan').replace(/é›™èƒèƒ/g, ' Kembar').replace(/ä¸‰èƒèƒ/g, ' Kembar Tiga').replace(/å©†å©†/g, ' Nenek').replace(/å…¬å…¬/g, ' Kakek').replace(/æ­²/g, 'th'); } return res; });
            if(adultCount > 0) { const label = lang === 'english' ? 'Adult' : 'Dewasa'; translatedOthers.unshift(`${adultCount} ${label}`); } return translatedOthers.join(', ');
        }
        function translatePets(text, lang) {
            if(!text) return '-'; if(text === 'æ²’æœ‰å¯µç‰©') return getDict('æ²’æœ‰å¯µç‰©', lang);
            const parts = text.split(', '); const petCounts = {}; const targetTypes = ['å°ç‹—','ä¸­ç‹—','å¤§ç‹—','è²“','å…”','é¸šéµ¡','çƒé¾œ']; let others = [];
            parts.forEach(p => { let matched = false; for(let t of targetTypes) { if(p.includes(t)) { const match = p.match(/^(\d+)(.+)$/); if(match && match[2] === t) { petCounts[t] = (petCounts[t] || 0) + parseInt(match[1]); matched = true; break; } } } if(!matched) others.push(p); });
            const mergedParts = []; for(let t in petCounts) mergedParts.push(`${petCounts[t]}${t}`); const allParts = mergedParts.concat(others);
            const translatedParts = allParts.map(p => { const match = p.match(/^(\d+)(.+)$/); if(match) { const qty = match[1]; const name = match[2]; const tName = getDict(name, lang); return `${qty} ${tName}`; } return p; });
            return translatedParts.join(', ');
        }
        function getDict(key, lang) { const t = lang === 'english' ? 'en' : 'id'; if(dict[key] && dict[key][t]) return dict[key][t]; if(key && key.length > 0) return key; return '-'; }
        window.changePage = function(dir) { currentPage += dir; const all = getAllEmployers(); const active = all.filter(e=>e.active); const total = Math.ceil(active.length/itemsPerPage); if(currentPage < 1) currentPage=1; if(currentPage>total) currentPage=total; renderPublicList(); window.scrollTo(0,0); };
        window.changeAdminPage = function(dir) { currentAdminPage += dir; const all = getAllEmployers(); const total = Math.ceil(all.length/itemsPerPage); if(currentAdminPage < 1) currentAdminPage=1; if(currentAdminPage>total) currentAdminPage=total; renderAdminList(); window.scrollTo(0,0); };
    </script>
</body>
</html>
