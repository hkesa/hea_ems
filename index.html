<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Employer List of Horizon Employment Agency</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        // ã€è¨­å®šå€åŸŸ 1ã€‘Firebase Config (è«‹ä¾ç…§æ•™å­¸å¡«å…¥ä½ çš„ Firebase è³‡æ–™)
        const firebaseConfig = {
            apiKey: "AIzaSyD0BE-lK6MAR-MMjhoOR-5jm3_5F2Qw1wo", 
            authDomain: "ems-hea.firebaseapp.com",
            projectId: "ems-hea",
            storageBucket: "ems-hea.firebasestorage.app",
            messagingSenderId: "995449881828",
            appId: "1:995449881828:web:58dd21bd3f072fd8cdd8f1",
	measurementId: "G-RK1QPVSG6L"
        };

        // ã€è¨­å®šå€åŸŸ 2ã€‘Google Sheets App Script URL (åªä½œå¯«å…¥å‚™ä»½ç”¨ï¼Œä¸è®€å–)
        window.GOOGLE_SCRIPT_URL = ""; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        window.isFirebaseMode = false;
        window.db = null;
        window.collection = collection;
        window.addDoc = addDoc;
        window.doc = doc;
        window.updateDoc = updateDoc;
        window.deleteDoc = deleteDoc;
        window.onSnapshot = onSnapshot;
        window.query = query;

        async function initSystem() {
            // ç°¡å–®æª¢æŸ¥æ˜¯å¦æœ‰å¡«å¯« Firebase Config (æª¢æŸ¥ apiKey æ˜¯å¦æœ‰å€¼)
            const isConfigured = firebaseConfig.apiKey && firebaseConfig.apiKey.length > 5;
            
            if (isConfigured) {
                try {
                    const app = initializeApp(firebaseConfig);
                    window.db = getFirestore(app);
                    window.isFirebaseMode = true;
                    document.getElementById('mode-badge').innerHTML = '<span class="bg-green-100 text-green-800 font-medium mr-2 px-2 py-1 rounded border border-green-400">Firebase é€£ç·šä¸­</span>';
                    window.initApp(); 
                    return;
                } catch (e) {
                    console.error("Firebase Init Error", e);
                    alert("Firebase é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Config");
                }
            } 
            
            // å¦‚æœæ²’æœ‰ Firebaseï¼Œå‰‡é€²å…¥å–®æ©Ÿæ¨¡å¼
            console.log("Offline Mode");
            document.getElementById('mode-badge').innerHTML = '<span class="bg-orange-100 text-orange-800 font-medium mr-2 px-2 py-1 rounded border border-orange-400">å–®æ©Ÿæ¨¡å¼ (è³‡æ–™åƒ…å­˜æ–¼æ­¤è£ç½®)</span>';
            const toast = document.getElementById('offline-toast');
            toast.classList.remove('hidden');
            setTimeout(() => { toast.classList.add('opacity-0'); setTimeout(()=>toast.remove(), 1000); }, 5000);
            
            window.initApp();
        }
        initSystem();
    </script>

    <style>
        :root { --fs-base: 18px; }
        html { font-size: var(--fs-base); } 
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: #f3f4f6; color: #1f2937; line-height: 1.6; }
        
        body, p, input, select, textarea, label, span, div, li, td, th, h1, h2, h3, h4, .text-lg, .text-xl, .text-2xl, .text-3xl { font-size: var(--fs-base) !important; }
        button, .btn-nav, .wa-btn, .file-btn, .salary-btn { font-size: var(--fs-base) !important; }
        
        .btn-nav { padding: 10px 20px; font-weight: bold; }
        .btn-nav.active { background-color: #1e40af; color: white; }
        .hidden-section { display: none; }
        
        #main-nav { transition: all 0.3s ease-in-out; }
        #main-nav.shrink { padding-top: 5px; padding-bottom: 5px; }
        
        @media (max-width: 640px) {
            #main-nav.shrink { padding-top: 2px; padding-bottom: 2px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
            #main-nav.shrink .nav-logo { font-size: 1.1rem !important; }
            .btn-nav-container { flex-wrap: nowrap !important; gap: 4px !important; width: 100%; padding-left: 5px; padding-right: 5px; }
            .btn-nav { padding: 8px 5px !important; font-size: 14px !important; flex: 1; white-space: nowrap; display: flex; justify-content: center; align-items: center; }
        }

        .wa-btn {
            background-color: #25D366; color: white;
            font-weight: bold; padding: 12px 24px; border-radius: 50px;
            display: inline-flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;
            text-decoration: none;
        }
        .wa-btn:hover { transform: scale(1.05); background-color: #1ebc57; }

        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            color: #1e40af; transition: opacity 0.5s;
        }
        
        input, select, textarea { padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; width: 100%; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        input[type="date"].date-left-icon { position: relative; padding-left: 42px; }
        input[type="date"].date-left-icon::-webkit-calendar-picker-indicator {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; cursor: pointer; padding: 0; margin: 0; opacity: 0.6;
        }
        input[type="date"].date-left-icon::-webkit-calendar-picker-indicator:hover { opacity: 1; }
        input[type="date"].date-left-icon::-webkit-datetime-edit { margin-left: 0; }
        
        .salary-btn {
            background-color: #e5e7eb; color: #374151; width: 60px; height: 100%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; user-select: none; font-weight: bold;
        }
        .salary-btn:hover { background-color: #d1d5db; }

        .error-msg { background-color: #fee2e2; color: #991b1b; padding: 4px 10px; border-radius: 4px; margin-top: 4px; display: none; font-weight: bold; }
        .error-msg.visible { display: block; }
        .input-error { border-color: #ef4444 !important; border-width: 2px !important; }

        .tag-checkbox:checked + label { background-color: #fce7f3; color: #9f1239; border-color: #f472b6; }
        .tag-checkbox:checked + label::before { content: 'âœ” '; }
        
        .internal-field { background-color: #f0f9ff; border: 2px solid #bae6fd; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .internal-label { color: #0369a1; font-weight: bold; display: block; margin-bottom: 8px; }
        
        .info-box {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border-left: 6px solid #3b82f6;
            padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .info-box h3 { color: #1e40af; margin-bottom: 15px; font-weight: bold; }
        .info-box p { margin-bottom: 12px; }
        .info-box li { margin-bottom: 8px; }
        .info-box a { color: #2563eb; text-decoration: underline; font-weight: bold; }
    </style>
</head>
<body class="pb-40 text-gray-800">

    <div id="loading-overlay">
        <div class="text-center">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl mb-4"></i><br>
            <span id="loading-text" class="text-xl font-bold">ç³»çµ±å•Ÿå‹•ä¸­...</span>
        </div>
    </div>

    <div id="offline-toast" class="hidden fixed bottom-5 right-5 bg-white border-l-4 border-orange-500 text-gray-700 p-4 rounded shadow-lg z-50 transition-opacity duration-1000 max-w-sm text-base">
        <p class="font-bold"><i class="fa-solid fa-triangle-exclamation text-orange-500"></i> ç›®å‰ç‚ºå–®æ©Ÿæ¨¡å¼</p>
        <p class="mt-1">å°šæœªè¨­å®š Firebaseã€‚</p>
    </div>

    <!-- å°èˆª -->
    <nav id="main-nav" class="bg-white shadow-md sticky top-0 z-50 py-4">
        <div class="max-w-screen-2xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex flex-col items-center md:items-start mb-2 md:mb-0 w-full md:w-auto">
                    <div class="nav-logo font-bold text-blue-900 text-center md:text-left text-2xl">
                        Employer List
                    </div>
                    <div id="mode-badge" class="mt-1"></div>
                </div>
                <div class="btn-nav-container flex gap-2 flex-wrap justify-center md:justify-end">
                    <button onclick="switchTab('admin')" id="nav-admin" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡­ğŸ‡° Agency</button>
                    <button onclick="switchTab('english')" id="nav-english" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡µğŸ‡­ English</button>
                    <button onclick="switchTab('indonesian')" id="nav-indonesian" class="btn-nav rounded hover:bg-blue-50 transition">ğŸ‡®ğŸ‡© Indonesian</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 1. ç™»å…¥é é¢ -->
    <section id="page-login" class="max-w-4xl mx-auto mt-10 p-6 hidden-section">
        <div class="grid grid-cols-1 gap-6 mb-10">
            <div class="info-box">
                <h3>Contact Information</h3>
                <p><b>Agency Name:</b> Horizon Employment Agency</p>
                <p><b>Agency Address:</b> Flat B, 5/F, Gaylord Commercial Building, 114-118 Lockhart Road, Wan Chai, Hong Kong</p>
                <p><b>Agency WhatsApp:</b> <a href="https://wa.me/85296111003" target="_blank">(+852) 96111003</a></p>
                <p><b>Like our Facebook:</b> <a href="https://www.facebook.com/HorizonHelpers" target="_blank">Horizon Helpers</a></p>
            </div>
            
            <div class="info-box" style="border-left-color: #10b981;">
                <h3>We need many</h3>
                <ul class="list-none pl-0">
                    <li>1ï¸âƒ£ Helpers</li>
                    <li>2ï¸âƒ£ Drivers</li>
                    <li>3ï¸âƒ£ Teachers</li>
                    <li>4ï¸âƒ£ Caregivers</li>
                    <li>5ï¸âƒ£ Nurses</li>
                    <li>6ï¸âƒ£ Gardeners</li>
                    <li>7ï¸âƒ£ Filipinos</li>
                    <li>8ï¸âƒ£ Indonesians</li>
                </ul>
                <h3 class="mt-6">Refer your friends and family</h3>
                <ul class="list-none pl-0">
                    <li>1ï¸âƒ£ From overseas</li>
                    <li>2ï¸âƒ£ Finishing contract in HK</li>
                    <li>3ï¸âƒ£ Refer an employer</li>
                    <li>4ï¸âƒ£ Renewing a contract</li>
                    <li>5ï¸âƒ£ Direct hire</li>
                    <li>6ï¸âƒ£ Friend of a friend</li>
                </ul>
            </div>
        </div>

        <div class="bg-white p-10 rounded-xl shadow-lg max-w-2xl mx-auto">
            <div class="text-center mb-8">
                <h2 class="font-bold text-gray-800">ç®¡ç†å“¡ç™»å…¥ Administrator Login</h2>
                <p class="text-gray-500 mt-4">è«‹è¼¸å…¥å¯†ç¢¼ä»¥ç¹¼çºŒ<br>Please enter password to continue</p>
            </div>
            <div class="mb-8">
                <input type="password" id="admin-password" class="w-full" placeholder="è¼¸å…¥å¯†ç¢¼ Enter Password">
                <p id="login-error" class="text-red-500 mt-2 hidden">å¯†ç¢¼éŒ¯èª¤ / Incorrect Password</p>
            </div>
            <button onclick="checkLogin()" class="w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-bold transition shadow">ç™»å…¥ Login</button>
        </div>
    </section>

    <!-- 2. ç®¡ç†å“¡å¾Œå° -->
    <section id="page-admin" class="max-w-screen-xl mx-auto mt-10 px-4 hidden-section">
        <div class="flex flex-wrap gap-4 mb-8 border-b pb-4">
            <button onclick="switchAdminSub('input')" class="px-6 py-3 rounded-full bg-blue-100 text-blue-800 font-bold hover:bg-blue-200 transition">æ–°è³‡æ–™è¼¸å…¥å™¨</button>
            <button onclick="switchAdminSub('fishing')" class="px-6 py-3 rounded-full bg-purple-100 text-purple-800 font-bold hover:bg-purple-200 transition">é‡£é­šç›¤</button>
            <button onclick="switchAdminSub('list')" class="px-6 py-3 rounded-full bg-yellow-100 text-yellow-800 font-bold hover:bg-yellow-200 transition">å·²ä¸Šè¼‰çš„è³‡æ–™</button>
        </div>

        <!-- INPUT / FISHING AREA -->
        <div id="admin-input-area" class="bg-white p-8 rounded-xl shadow-md">
            <div id="fishing-header" class="hidden mb-8 bg-purple-50 p-6 rounded-lg border border-purple-200 flex justify-between items-center">
                <span class="font-bold text-purple-800">ğŸ¬ é‡£é­šç›¤æ¨¡å¼ (éš¨æ©Ÿç”Ÿæˆ)</span>
                <button onclick="generateFishingData()" class="bg-purple-600 text-white px-6 py-3 rounded font-bold hover:bg-purple-700 transition">é‡æ–°ç”Ÿæˆæ•¸æ“š</button>
            </div>

            <!-- Clear Content Button (Input Mode Only) -->
            <div id="clear-btn-container" class="mb-4 flex flex-col sm:flex-row justify-start items-center gap-4 bg-gray-50 p-3 rounded-lg border border-gray-100">
                <button type="button" onclick="clearInputForm()" class="bg-red-50 text-red-600 px-4 py-2 rounded border border-red-200 hover:bg-red-100 font-bold whitespace-nowrap">
                    <i class="fa-solid fa-trash mr-1"></i> æ¸…é™¤å…§å®¹
                </button>
                <span class="text-sm text-gray-500 font-medium">æ¯æ¬¡è¼¸å…¥æ–°è³‡æ–™å‰ï¼Œå…ˆæŒ‰ä¸€æŒ‰ã€Œæ¸…é™¤å…§å®¹ã€æŒ‰éˆ•</span>
            </div>

            <form id="employer-form" class="space-y-8">
                <input type="hidden" id="edit-doc-id"> 
                
                <!-- 1. åƒ±ä¸»ç·¨è™Ÿ -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">åƒ±ä¸»ç·¨è™Ÿ (ç·¨è™Ÿä»¥Eé–‹å§‹ï¼Œä¾‹å¦‚ï¼šE2805)</label>
                    <input type="text" id="inp-id" class="bg-gray-50" placeholder="ä¾‹å¦‚ï¼šE2805" onblur="validate(this)">
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 2. å®¶åº­æˆå“¡ -->
                <div class="flex flex-col p-6 bg-gray-50 rounded-lg border">
                    <label class="font-bold text-gray-700 mb-3">å®¶åº­æˆå“¡åŠå¹´é½¡ (å¯ä»¥å¤šé¸)</label>
                    <div id="member-list-display" class="mb-3 flex flex-wrap gap-3 min-h-[40px]"></div>
                    <input type="hidden" id="inp-members-string" onblur="validateMember(this)">
                    <div class="error-msg" id="member-error">è«‹è‡³å°‘æ–°å¢ä¸€ä½å®¶åº­æˆå“¡</div>
                    
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <label class="text-gray-500 mb-1 block">æˆå“¡é¡å‹</label>
                            <select id="mem-type" onchange="toggleAgeInput()">
                                <option value="æˆäºº">æˆäºº Adult</option>
                                <option value="å°å­©">å°å­© Child</option>
                                <option value="ç”·å­©">ç”·å­© Boy</option>
                                <option value="å¥³å­©">å¥³å­© Girl</option>
                                <option value="é›™èƒèƒ">é›™èƒèƒ Twins</option>
                                <option value="ä¸‰èƒèƒ">ä¸‰èƒèƒ Triplets</option>
                                <option value="é•·è€…">é•·è€… Elderly</option>
                                <option value="å…¬å…¬">å…¬å…¬ Grandpa</option>
                                <option value="å©†å©†">å©†å©† Grandma</option>
                            </select>
                        </div>
                        <div class="w-32 hidden" id="age-input-group">
                            <label class="text-gray-500 mb-1 block">å¹´é½¡</label>
                            <input type="number" id="mem-age" placeholder="æ­²">
                        </div>
                        <button type="button" onclick="addMember()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 h-full">æ–°å¢</button>
                    </div>
                </div>

                <!-- 3. åœ°å€ -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">åƒ±ä¸»åœ°å€ (Employer Location)</label>
                    <input type="text" id="inp-location" placeholder="ä¾‹å¦‚ï¼šå°‡è»æ¾³" onblur="validate(this)">
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- å…§éƒ¨æ¬„ä½ï¼šå–®ä½å‘æ•¸ -->
                <div class="flex flex-col internal-field input-only-field">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> å–®ä½å‘æ•¸ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                    <input type="text" id="inp-flat-size" placeholder="ä¾‹å¦‚ï¼š500å‘" onblur="validate(this)">
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 4. å¯µç‰© -->
                <div class="flex flex-col p-6 bg-gray-50 rounded-lg border">
                    <label class="font-bold text-gray-700 mb-3">å¯µç‰© (å¯ä»¥å¤šé¸)</label>
                    <div id="pet-list-display" class="mb-3 flex flex-wrap gap-3 min-h-[40px]"></div>
                    <input type="hidden" id="inp-pets-string" onblur="validatePet(this)">
                    <div class="error-msg" id="pet-error">è«‹è‡³å°‘æ–°å¢ä¸€é …å¯µç‰©è³‡æ–™(æˆ–é¸ç„¡)</div>
                    
                    <div class="flex gap-4 items-end flex-wrap">
                        <div class="flex-1 min-w-[200px]">
                            <label class="text-gray-500 mb-1 block">å¯µç‰©é¡å‹</label>
                            <select id="pet-add-type" onchange="togglePetInputs()">
                                <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                                <option value="æ²’æœ‰å¯µç‰©">æ²’æœ‰å¯µç‰©</option>
                                <option value="å°ç‹—">å°ç‹— Small Dog</option>
                                <option value="ä¸­ç‹—">ä¸­ç‹— Medium Dog</option>
                                <option value="å¤§ç‹—">å¤§ç‹— Big Dog</option>
                                <option value="è²“">è²“ Cat</option>
                                <option value="å…”">å…” Rabbit</option>
                                <option value="é¸šéµ¡">é¸šéµ¡ Parrot</option>
                                <option value="çƒé¾œ">çƒé¾œ Turtle</option>
                                <option value="å…¶ä»–">å…¶ä»– Other</option>
                            </select>
                        </div>
                        <div id="pet-other-group" class="w-full hidden order-last mt-2">
                            <input type="text" id="inp-pets-other-text" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«ï¼Œä¾‹å¦‚ï¼šHamster">
                        </div>
                        <div class="w-40 hidden" id="pet-qty-group">
                             <label class="text-gray-500 mb-1 block">æ•¸é‡</label>
                             <div class="flex border rounded-lg overflow-hidden bg-white h-[54px]">
                                 <input type="number" id="pet-add-qty" class="w-full p-2 text-center border-none outline-none" value="1" min="1" style="font-size: 26px;">
                                 <div class="flex gap-1 pr-1 items-center bg-gray-100">
                                     <button type="button" onclick="adjPet(1)" class="w-12 h-full bg-gray-200 hover:bg-gray-300 font-bold text-xl">â–²</button>
                                     <button type="button" onclick="adjPet(-1)" class="w-12 h-full bg-gray-200 hover:bg-gray-300 font-bold text-xl">â–¼</button>
                                 </div>
                             </div>
                        </div>
                        <button type="button" onclick="addPetToList()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 h-[54px]">æ–°å¢</button>
                    </div>
                </div>

                <!-- 5. å·¥äººæˆ¿ -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">å·¥äººæˆ¿ (Helper Room)</label>
                    <select id="inp-room" onchange="toggleRoomOther()" onblur="validate(this)">
                        <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                        <option value="æœ‰å·¥äººæˆ¿">æœ‰å·¥äººæˆ¿</option>
                        <option value="èˆ‡å°å­©åŒæˆ¿">èˆ‡å°å­©åŒæˆ¿</option>
                        <option value="èˆ‡é•·è€…åŒæˆ¿">èˆ‡é•·è€…åŒæˆ¿</option>
                        <option value="èˆ‡å¦å¤–å‚­åŒæˆ¿">èˆ‡å¦å¤–å‚­åŒæˆ¿</option>
                        <option value="èˆ‡å¥³åƒ±ä¸»åŒæˆ¿">èˆ‡å¥³åƒ±ä¸»åŒæˆ¿</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                    <input type="text" id="inp-room-other" class="mt-2 hidden" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«" onblur="validateOther(this, 'inp-room')">
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 6. ä¸Šç­æ—¥æœŸ -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">ä¸Šç­æ—¥æœŸ (Start Date)</label>
                    <select id="inp-date" onblur="validate(this)">
                        <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                        <option value="ç›¡å¿«">ç›¡å¿«</option>
                        <option value="ä¸€æœˆ">ä¸€æœˆ</option>
                        <option value="äºŒæœˆ">äºŒæœˆ</option>
                        <option value="ä¸‰æœˆ">ä¸‰æœˆ</option>
                        <option value="å››æœˆ">å››æœˆ</option>
                        <option value="äº”æœˆ">äº”æœˆ</option>
                        <option value="å…­æœˆ">å…­æœˆ</option>
                        <option value="ä¸ƒæœˆ">ä¸ƒæœˆ</option>
                        <option value="å…«æœˆ">å…«æœˆ</option>
                        <option value="ä¹æœˆ">ä¹æœˆ</option>
                        <option value="åæœˆ">åæœˆ</option>
                        <option value="åä¸€æœˆ">åä¸€æœˆ</option>
                        <option value="åäºŒæœˆ">åäºŒæœˆ</option>
                    </select>
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 7. è–ªé‡‘ (æŒ‰éˆ•å·²äº’æ›) -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">è–ªé‡‘ (Salary)</label>
                    <div class="flex items-center gap-3">
                        <input type="number" id="inp-salary" class="flex-1" placeholder="ä¾‹å¦‚ï¼š5100" onblur="validate(this)">
                        <div class="flex gap-2 h-full">
                            <!-- äº’æ›ä½ç½®ï¼šå·¦é‚Šè®Š â–²ï¼Œå³é‚Šè®Š â–¼ -->
                            <div onclick="adjustSalary(100)" class="salary-btn rounded-l-lg border border-gray-300">â–²</div>
                            <div onclick="adjustSalary(-100)" class="salary-btn rounded-r-lg border border-gray-300">â–¼</div>
                        </div>
                    </div>
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- å…§éƒ¨æ¬„ä½ï¼šè«®è©¢é¡åˆ¥ -->
                <div class="flex flex-col internal-field input-only-field mt-2">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> è«®è©¢é¡åˆ¥ (å¯ä»¥å¤šé¸) å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„</label>
                    <div class="flex flex-wrap gap-3" id="overseas-options"></div>
                    <input type="hidden" id="inp-overseas-local">
                    <div class="error-msg" id="overseas-error">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 8. åœ‹ç± -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">åœ‹ç±è¦æ±‚ (Nationality Required)</label>
                    <select id="inp-nationality" onchange="toggleNatOther()" onblur="validate(this)">
                        <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                        <option value="Filipino">è²å‚­ Filipino</option>
                        <option value="Indonesian">å°å‚­ Indonesian</option>
                        <option value="Filipino & Indonesian">è²å° Filipino & Indonesian</option>
                        <option value="Indonesian & Filipino">å°è² Indonesian & Filipino</option>
                        <option value="Other">å…¶ä»– (Other)</option>
                    </select>
                    <input type="text" id="inp-nationality-other" class="mt-2 hidden" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«ï¼Œä¾‹å¦‚ï¼šSri Lankans" onblur="validateOther(this, 'inp-nationality')">
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- 9. èªè¨€ -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">èªè¨€è¦æ±‚ (Language Required)</label>
                    <select id="inp-lang" onblur="validate(this)">
                        <option value="" disabled selected hidden>è«‹é¸æ“‡...</option>
                        <option value="è‹±æ–‡">è‹±æ–‡</option>
                        <option value="å»£æ±è©±">å»£æ±è©±</option>
                        <option value="æ™®é€šè©±">æ™®é€šè©±</option>
                        <option value="è‹±æ–‡&å»£æ±è©±">è‹±æ–‡&å»£æ±è©±</option>
                        <option value="è‹±æ–‡&æ™®é€šè©±">è‹±æ–‡&æ™®é€šè©±</option>
                    </select>
                    <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                </div>

                <!-- å…§éƒ¨æ¬„ä½ï¼šåƒ±ä¸»è¦æ±‚ -->
                <div class="flex flex-col internal-field input-only-field mt-2">
                    <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»è¦æ±‚æˆ–ç•™è¨€ (å¦‚æœ‰) å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„</label>
                    <textarea id="inp-emp-req" class="h-32" placeholder="å…¬å¸å…§éƒ¨ä½¿ç”¨ï¼Œä¸å¤–å‚³"></textarea>
                </div>

                <!-- 10. å‚™è¨» -->
                <div class="flex flex-col">
                    <label class="font-bold text-gray-700 mb-2">å…¬é–‹å‚™è¨»çµ¦å¤–å‚­çœ‹ (å¦‚æœ‰) (Remarks)</label>
                    <textarea id="inp-remarks" class="h-32" placeholder="çµ¦å¤–å‚­çœ‹ï¼Œæœƒå¤–å‚³ï¼Œè«‹å°å¿ƒå¡«å¯«ï¼Œè«‹ä»¥è‹±æ–‡å¡«å¯«"></textarea>
                </div>

                <!-- Tags Section -->
                <div class="flex flex-col p-6 bg-pink-50 border border-pink-200 rounded-lg">
                    <label class="font-bold text-pink-800 mb-3">åŠ ä¸Šæ¨™ç±¤ (å¦‚æœ‰) å¯ä»¥å¤šé¸</label>
                    <div id="tags-container" class="flex flex-wrap gap-3 mb-3"></div>
                    <div class="mt-2">
                        <input type="checkbox" id="tag-other-check" class="hidden" onchange="toggleTagOther()">
                        <label for="tag-other-check" class="bg-white border border-pink-300 text-pink-700 px-4 py-2 rounded cursor-pointer hover:bg-pink-100 select-none">å…¶ä»– Other</label>
                        <input type="text" id="tag-other-text" class="mt-2 w-full hidden" placeholder="è«‹ä»¥è‹±æ–‡å¡«å¯«" onblur="validateTagOther(this)">
                        <div class="error-msg" id="tag-other-error">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                </div>

                <!-- å…§éƒ¨æ¬„ä½ç¾¤çµ„ (Input Only) -->
                <div class="flex flex-col gap-6 mt-4 input-only-field">
                    <div class="flex flex-col internal-field">
                        <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»å§“å (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                        <input type="text" id="inp-emp-name" onblur="validate(this)">
                        <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                    <div class="flex flex-col internal-field">
                        <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»èªè¨€ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                        <select id="inp-emp-lang" onblur="validate(this)">
                            <option value="">è«‹é¸æ“‡...</option>
                            <option value="è‹±æ–‡">è‹±æ–‡</option>
                            <option value="å»£æ±è©±">å»£æ±è©±</option>
                            <option value="æ™®é€šè©±">æ™®é€šè©±</option>
                            <option value="æ™®é€šè©±ä½†è­˜å»£æ±è©±">æ™®é€šè©±ä½†è­˜å»£æ±è©±</option>
                        </select>
                        <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                    <div class="flex flex-col internal-field">
                        <label class="internal-label"><i class="fa-solid fa-lock"></i> åƒ±ä¸»é›»è©± (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                        <input type="text" id="inp-emp-phone" onblur="validate(this)">
                        <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                    <div class="flex flex-col internal-field">
                        <label class="internal-label"><i class="fa-solid fa-lock"></i> æŸ¥è©¢æ—¥æœŸ (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                        <!-- æ—¥æœŸåœ–ç¤ºåœ¨å·¦é‚Š -->
                        <input type="date" id="inp-inquiry-date" class="date-left-icon" onblur="validate(this)">
                        <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                    <div class="flex flex-col internal-field">
                        <label class="internal-label"><i class="fa-solid fa-lock"></i> ä»‹ç´¹äºº (å¤–å‚­çœ‹ä¸åˆ°ï¼Œå…§éƒ¨ç´€éŒ„)</label>
                        <input type="text" id="inp-referrer" placeholder="ä¾‹å¦‚ï¼šèˆŠå®¢E1234ã€Googleå»£å‘Š" onblur="validate(this)">
                        <div class="error-msg">æ­¤æ¬„ä½å¿…å¡«</div>
                    </div>
                </div>

                <button type="button" onclick="handleSave()" id="btn-save" class="w-full bg-green-600 text-white font-bold py-5 rounded-xl hover:bg-green-700 mt-10 shadow transition">
                    <i class="fa-solid fa-upload mr-2"></i> <span id="btn-save-text">ä¸Šè¼‰è³‡æ–™</span>
                </button>
            </form>
        </div>

        <div id="admin-list-area" class="hidden">
            <h3 class="font-bold text-blue-900 mb-6">å·²ä¸Šè¼‰çš„è³‡æ–™ <span id="db-status-text" class="font-normal text-gray-500"></span></h3>
            <div id="admin-records-container" class="space-y-8"></div>
            <!-- Pagination for Admin -->
            <div id="admin-pagination" class="flex justify-center items-center gap-8 mt-10 hidden">
                <button onclick="changeAdminPage(-1)" class="px-6 py-3 bg-white border rounded hover:bg-gray-100">Prev</button>
                <span id="admin-page-indicator" class="font-bold text-gray-700">Page 1</span>
                <button onclick="changeAdminPage(1)" class="px-6 py-3 bg-white border rounded hover:bg-gray-100">Next</button>
            </div>
        </div>
    </section>

    <!-- 3. å…¬é–‹é é¢ -->
    <section id="page-public" class="max-w-screen-2xl mx-auto mt-10 px-4 hidden-section">
        <div class="mb-10 flex flex-col items-center">
            <div id="banner-box" class="w-full max-w-5xl mb-6 p-6 rounded-lg text-left shadow-md border-l-8 bg-blue-50 border-blue-300 text-black">
                <p id="banner-text" class="leading-relaxed"></p>
            </div>
            <a href="https://wa.me/85296111003" target="_blank" class="wa-btn">
                <i class="fa-brands fa-whatsapp" style="font-size: 40px;"></i> <span id="wa-text">WhatsApp 9611 1003</span>
            </a>
        </div>

        <h2 id="public-title" class="font-bold text-blue-900 mb-8 border-l-8 border-blue-500 pl-6">Employer List</h2>

        <div id="public-records-container" class="grid grid-cols-1 md:grid-cols-2 gap-10"></div>

        <div id="pagination-controls" class="flex flex-col items-center gap-4 mt-16 mb-20">
            <div class="flex justify-center gap-8">
                <button onclick="changePage(-1)" id="btn-prev" class="px-8 py-4 bg-white border rounded-lg hover:bg-gray-100 font-bold shadow">Prev</button>
                <span id="page-indicator" class="font-bold text-gray-700 self-center">Page 1</span>
                <button onclick="changePage(1)" id="btn-next" class="px-8 py-4 bg-white border rounded-lg hover:bg-gray-100 font-bold shadow">Next</button>
            </div>
            <!-- Footer Message -->
            <div id="public-footer-msg" class="w-full max-w-5xl p-4 bg-blue-50 text-black text-center rounded-lg mt-4 hidden"></div>
            <!-- Version Number -->
            <div class="text-center text-gray-400 mt-10 mb-4">V1.14</div>
        </div>
    </section>

    <script>
        let employers = [];
        const PASSWORD = 'admin@ADA2018';
        let currentPage = 1;
        let currentAdminPage = 1;
        const itemsPerPage = 10;
        let currentLang = 'english';
        const LOCAL_STORAGE_KEY = 'horizon_employers_offline_v8';
        const LAST_ID_KEY = 'horizon_last_id_num';
        
        let currentAdminSub = 'input';
        let inputCache = null;

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('main-nav');
            if (window.scrollY > 50) { nav.classList.add('shrink'); } 
            else { nav.classList.remove('shrink'); }
        });

        const tagList = [
            "æ€¥ Urgent", "é«˜è–ª High salary", "è¿‘åœ°éµ Near MTR", "å¤§å­¸ University", "å¥½åƒ±ä¸» Good employer",
            "ä¸€å€‹å°å­© 1 child only", "ä¸€å€‹é•·è€… 1 elderly only", "2å€‹é•·è€… 2 elderly only", "3å€‹é•·è€… 3 elderly only",
            "ä¸€ä½æˆäºº 1 adult only", "2ä½æˆäºº 2 adult only", "3ä½æˆäºº 3 adult only",
            "è«‹å¸æ©Ÿ Hire Driver", "è«‹æµ·å¤– Hire overseas helper", "è«‹ç”·å¤–å‚­ Hire male helper",
            "ç‹—ç¶“é©— Dog experience", "è²“ç¶“é©— Cat experience", "å¯µç‰©ç¶“é©— Pet experience",
            "è­·å£«ç¶“é©— Nursing experience", "è€å¸«ç¶“é©— Teacher experience", "åˆç”Ÿç¶“é©— Babysitter experience", "ç…§é¡§è€…ç¶“é©— Caregiver experience",
            "ç…§é¡§ç‰¹åˆ¥ Special care", "ç…§é¡§æ®˜ç–¾ Disability care", "ç…§é¡§ç™±ç˜“ Bedridden care", "ç…§é¡§æ’å–‰ Tracheostomy care",
            "æ¨è¼ªæ¤… Wheelchair", "èµ°è·¯ç·©æ…¢ Walking slowly", "é¤µè—¥ Medication feeding", "æ²–æ¶¼ Bathing assistance",
            "ä¸­é¢¨ Stroke", "è€äººç—´å‘† Alzheimer's disease", "æŸé‡‘éœç—… Parkinson's disease", "çºŒç´„å„ªå…ˆ Renewal priority"
        ];
        
        const tagMapIndo = {
            "æ€¥ Urgent": "Mendesak", "é«˜è–ª High salary": "Gaji tinggi", "è¿‘åœ°éµ Near MTR": "Dekat MTR", "å¤§å­¸ University": "Universitas", "å¥½åƒ±ä¸» Good employer": "Majikan baik",
            "ä¸€å€‹å°å­© 1 child only": "Hanya 1 anak", "ä¸€å€‹é•·è€… 1 elderly only": "Hanya 1 lansia", "2å€‹é•·è€… 2 elderly only": "Hanya 2 lansia", "3å€‹é•·è€… 3 elderly only": "Hanya 3 lansia",
            "ä¸€ä½æˆäºº 1 adult only": "Hanya 1 dewasa", "2ä½æˆäºº 2 adult only": "Hanya 2 dewasa", "3ä½æˆäºº 3 adult only": "Hanya 3 dewasa",
            "è«‹å¸æ©Ÿ Hire Driver": "Merekrut sopir", "è«‹æµ·å¤– Hire overseas helper": "Merekrut PRT luar negeri", "è«‹ç”·å¤–å‚­ Hire male helper": "Merekrut PRT laki-laki",
            "ç‹—ç¶“é©— Dog experience": "Pengalaman merawat anjing", "è²“ç¶“é©— Cat experience": "Pengalaman merawat kucing", "å¯µç‰©ç¶“é©— Pet experience": "Pengalaman merawat hewan peliharaan",
            "è­·å£«ç¶“é©— Nursing experience": "Pengalaman keperawatan", "è€å¸«ç¶“é©— Teacher experience": "Pengalaman sebagai guru", "åˆç”Ÿç¶“é©— Babysitter experience": "Pengalaman menjaga bayi baru lahir",
            "ç…§é¡§è€…ç¶“é©— Caregiver experience": "Pengalaman merawat lansia", "ç…§é¡§ç‰¹åˆ¥ Special care": "Perawatan khusus", "ç…§é¡§æ®˜ç–¾ Disability care": "Perawatan disabilitas",
            "ç…§é¡§ç™±ç˜“ Bedridden care": "Perawatan pasien terbaring", "ç…§é¡§æ’å–‰ Tracheostomy care": "Perawatan trakeostomi", "æ¨è¼ªæ¤… Wheelchair": "Dorong kursi roda",
            "èµ°è·¯ç·©æ…¢ Walking slowly": "Berjalan perlahan", "é¤µè—¥ Medication feeding": "Pemberian obat", "æ²–æ¶¼ Bathing assistance": "Bantuan mandi",
            "ä¸­é¢¨ Stroke": "Stroke", "è€äººç—´å‘† Alzheimer's disease": "Penyakit Alzheimer", "æŸé‡‘éœç—… Parkinson's disease": "Penyakit Parkinson", "çºŒç´„å„ªå…ˆ Renewal priority": "Prioritas perpanjangan kontrak",
            "å…¶ä»– Other": "Lainnya"
        };

        const overseasList = ["æœ¬åœ°", "æµ·å¤–", "æœªå‡ºåœ‹", "exé¦™æ¸¯", "ä¸­æ±", "å°ç£", "æ–°åŠ å¡", "é¦¬ä¾†è¥¿äº"];

        const locationMap = {
            "ä¸­ç’°": "Central", "é‡‘é˜": "Admiralty", "ç£ä»”": "Wan Chai", "éŠ…é‘¼ç£": "Causeway Bay", "åŒ—è§’": "North Point",
            "å¤ªå¤": "Tai Koo", "ç­²ç®•ç£": "Shau Kei Wan", "æŸ´ç£": "Chai Wan", "å°–æ²™å’€": "Tsim Sha Tsui", "ä½æ•¦": "Jordan",
            "æ²¹éº»åœ°": "Yau Ma Tei", "æ—ºè§’": "Mong Kok", "å¤ªå­": "Prince Edward", "æ·±æ°´åŸ—": "Sham Shui Po", "é•·æ²™ç£": "Cheung Sha Wan",
            "è”æè§’": "Lai Chi Kok", "ç¾å­š": "Mei Foo", "ä¹é¾å¡˜": "Kowloon Tong", "é»ƒå¤§ä»™": "Wong Tai Sin", "é‘½çŸ³å±±": "Diamond Hill",
            "å½©è™¹": "Choi Hung", "ä¹é¾ç£": "Kowloon Bay", "ç‰›é ­è§’": "Ngau Tau Kok", "è§€å¡˜": "Kwun Tong", "è—ç”°": "Lam Tin",
            "èª¿æ™¯å¶º": "Tiu Keng Leng", "å°‡è»æ¾³": "Tseung Kwan O", "å‘å£": "Hang Hau", "å¯¶ç³": "Po Lam", "å¤§åœ": "Tai Wai",
            "æ²™ç”°": "Sha Tin", "ç«ç‚­": "Fo Tan", "å¤§å­¸": "University", "å¤§åŸ”å¢Ÿ": "Tai Po Market", "å¤ªå’Œ": "Tai Wo",
            "ç²‰å¶º": "Fanling", "ä¸Šæ°´": "Sheung Shui", "èƒç£": "Tsuen Wan", "å¤§çª©å£": "Tai Wo Hau", "è‘µèˆˆ": "Kwai Hing",
            "è‘µèŠ³": "Kwai Fong", "é’è¡£": "Tsing Yi", "æ±æ¶Œ": "Tung Chung", "å…ƒæœ—": "Yuen Long", "å±¯é–€": "Tuen Mun", "å¤©æ°´åœ": "Tin Shui Wai"
        };

        const dict = {
            'æœ‰å·¥äººæˆ¿': { en: 'Yes, have own room', id: 'Ya, ada kamar sendiri' },
            'èˆ‡å°å­©åŒæˆ¿': { en: 'Share room with kid', id: 'Berbagi kamar dengan anak' },
            'èˆ‡é•·è€…åŒæˆ¿': { en: 'Share room with elderly', id: 'Berbagi kamar dengan lansia' },
            'èˆ‡å¦å¤–å‚­åŒæˆ¿': { en: 'Share with other helper', id: 'Berbagi dengan pembantu lain' },
            'èˆ‡å¥³åƒ±ä¸»åŒæˆ¿': { en: 'Share with female employer', id: 'Berbagi dengan majikan wanita' },
            'ç›¡å¿«': { en: 'ASAP', id: 'Secepatnya' },
            'ä¸€æœˆ': { en: 'January', id: 'Januari' }, 'äºŒæœˆ': { en: 'February', id: 'Februari' }, 'ä¸‰æœˆ': { en: 'March', id: 'Maret' },
            'å››æœˆ': { en: 'April', id: 'April' }, 'äº”æœˆ': { en: 'May', id: 'Mei' }, 'å…­æœˆ': { en: 'June', id: 'Juni' },
            'ä¸ƒæœˆ': { en: 'July', id: 'Juli' }, 'å…«æœˆ': { en: 'August', id: 'Agustus' }, 'ä¹æœˆ': { en: 'September', id: 'September' },
            'åæœˆ': { en: 'October', id: 'Oktober' }, 'åä¸€æœˆ': { en: 'November', id: 'November' }, 'åäºŒæœˆ': { en: 'December', id: 'Desember' },
            'å»£æ±è©±': { en: 'Cantonese', id: 'Kantonis' }, 'è‹±æ–‡': { en: 'English', id: 'Inggris' }, 'æ™®é€šè©±': { en: 'Mandarin', id: 'Mandarin' },
            'è‹±æ–‡&å»£æ±è©±': { en: 'English & Cantonese', id: 'Inggris & Kantonis' }, 'è‹±æ–‡&æ™®é€šè©±': { en: 'English & Mandarin', id: 'Inggris & Mandarin' },
            'å°ç‹—': { en: 'Small Dog', id: 'Anjing Kecil' }, 'ä¸­ç‹—': { en: 'Medium Dog', id: 'Anjing Sedang' }, 'å¤§ç‹—': { en: 'Big Dog', id: 'Anjing Besar' },
            'è²“': { en: 'Cat', id: 'Kucing' }, 'å…”': { en: 'Rabbit', id: 'Kelinci' },
            'é¸šéµ¡': { en: 'Parrot', id: 'Burung Beo' }, 'çƒé¾œ': { en: 'Turtle', id: 'Kura-kura' },
            'å…¶ä»–': { en: 'Other', id: 'Lainnya' }, 'æ²’æœ‰å¯µç‰©': { en: 'No Pets', id: 'Tidak ada hewan peliharaan' }
        };

        window.initApp = async function() {
            document.getElementById('loading-overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
            renderTags(); renderOverseasOptions();
            document.getElementById('inp-inquiry-date').valueAsDate = new Date();

            if (window.isFirebaseMode && window.db) {
                const q = window.query(window.collection(window.db, "employers"));
                window.onSnapshot(q, (snapshot) => {
                    employers = [];
                    snapshot.forEach((doc) => employers.push({ ...doc.data(), docId: doc.id }));
                    employers.sort((a, b) => a.id.localeCompare(b.id));
                    refreshCurrentView();
                });
            } else {
                const data = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (data) employers = JSON.parse(data);
                refreshCurrentView();
            }
            switchTab('english');
        };
        function refreshCurrentView() {
            if(!document.getElementById('admin-list-area').classList.contains('hidden')) renderAdminList();
            if(!document.getElementById('page-public').classList.contains('hidden')) renderPublicList();
        }

        function getNextId(prefix) {
            let max = 0;
            if (prefix === 'E') max = 2804; 
            if (prefix === 'U') max = 1000; 

            employers.forEach(e => {
                if (e.id && e.id.startsWith(prefix)) {
                    const numPart = parseInt(e.id.substring(1));
                    if (!isNaN(numPart) && numPart > max) {
                        max = numPart;
                    }
                }
            });
            return prefix + (max + 1);
        }

        function renderTags() {
            const c = document.getElementById('tags-container');
            c.innerHTML = tagList.map(t => `
                <div class="mb-2">
                    <input type="checkbox" id="tag-${t}" value="${t}" class="hidden tag-checkbox">
                    <label for="tag-${t}" class="bg-white border border-pink-300 text-pink-700 px-4 py-2 rounded cursor-pointer hover:bg-pink-100 select-none">${t}</label>
                </div>
            `).join('');
        }
        function renderOverseasOptions() {
            const c = document.getElementById('overseas-options');
            c.innerHTML = overseasList.map(o => `
                <label class="inline-flex items-center bg-white border px-4 py-2 rounded cursor-pointer border-blue-200">
                    <input type="checkbox" class="form-checkbox h-5 w-5 text-blue-600 overseas-check" value="${o}">
                    <span class="ml-2">${o}</span>
                </label>
            `).join('');
        }
        window.toggleTagOther = function() {
            const chk = document.getElementById('tag-other-check');
            const inp = document.getElementById('tag-other-text');
            const err = document.getElementById('tag-other-error');
            if(chk.checked) inp.classList.remove('hidden'); else { inp.classList.add('hidden'); err.classList.remove('visible'); }
        }

        window.validate = function(el) {
            if(document.getElementById('fishing-header').classList.contains('hidden') === false) { return; }
            
            const idVal = document.getElementById('inp-id').value.trim();
            const isU = idVal.toUpperCase().startsWith('U');
            if (isU && el.closest('.input-only-field')) {
                el.classList.remove('input-error'); 
                const err = el.parentElement.querySelector('.error-msg');
                if(err) err.classList.remove('visible');
                return;
            }

            const err = el.parentElement.querySelector('.error-msg');
            if(!el.value) { el.classList.add('input-error'); if(err) err.classList.add('visible'); } 
            else { el.classList.remove('input-error'); if(err) err.classList.remove('visible'); }
        }
        window.validateMember = function(el) {
            if(!document.getElementById('fishing-header').classList.contains('hidden')) return;
            const err = document.getElementById('member-error');
            if(!el.value) err.classList.add('visible'); else err.classList.remove('visible');
        }
        window.validatePet = function(el) {
            if(!document.getElementById('fishing-header').classList.contains('hidden')) return;
            const err = document.getElementById('pet-error');
            if(!el.value) err.classList.add('visible'); else err.classList.remove('visible');
        }
        window.validateTagOther = function(el) {
            if(!document.getElementById('fishing-header').classList.contains('hidden')) return;
            const chk = document.getElementById('tag-other-check');
            const err = document.getElementById('tag-other-error');
            if(chk.checked && !el.value) { el.classList.add('input-error'); err.classList.add('visible'); }
            else { el.classList.remove('input-error'); err.classList.remove('visible'); }
        }
        window.validateOverseas = function() {
            if(!document.getElementById('fishing-header').classList.contains('hidden')) return true;
            
            const idVal = document.getElementById('inp-id').value.trim();
            if (idVal.toUpperCase().startsWith('U')) return true;

            const chks = document.querySelectorAll('.overseas-check:checked');
            const err = document.getElementById('overseas-error');
            if(chks.length === 0) { err.classList.add('visible'); return false; }
            else { err.classList.remove('visible'); return true; }
        }
        window.validateOther = function(el, selectId) {
            const select = document.getElementById(selectId);
            const err = el.parentElement.querySelector('.error-msg');
            if(select.value === 'å…¶ä»–' || select.value === 'Other') {
                if(!el.value) { el.classList.add('input-error'); if(err) err.classList.add('visible'); }
                else { el.classList.remove('input-error'); if(err) err.classList.remove('visible'); }
            }
        }

        let currentPets = [];
        window.adjPet = function(v) { let el=document.getElementById('pet-add-qty'); let n=parseInt(el.value)+v; if(n<1)n=1; el.value=n; }
        window.togglePetInputs = function() {
            const type = document.getElementById('pet-add-type').value;
            const qtyGroup = document.getElementById('pet-qty-group');
            const otherGroup = document.getElementById('pet-other-group');
            qtyGroup.classList.add('hidden'); otherGroup.classList.add('hidden');
            if(type === 'å…¶ä»–') { otherGroup.classList.remove('hidden'); qtyGroup.classList.remove('hidden'); }
            else if(type !== 'æ²’æœ‰å¯µç‰©' && type !== '') { qtyGroup.classList.remove('hidden'); }
        }
        window.addPetToList = function() {
            const type = document.getElementById('pet-add-type').value;
            const qty = document.getElementById('pet-add-qty').value;
            if (!type) { alert('è«‹é¸æ“‡å¯µç‰©é¡å‹'); return; }
            if (type === 'æ²’æœ‰å¯µç‰©') { currentPets = [{text: 'æ²’æœ‰å¯µç‰©'}]; } 
            else {
                if(currentPets.length===1 && currentPets[0].text==='æ²’æœ‰å¯µç‰©') currentPets=[];
                if(type === 'å…¶ä»–') {
                    const ot = document.getElementById('inp-pets-other-text').value;
                    if(!ot) { alert('è«‹å¡«å¯«å¯µç‰©é¡å‹'); return; }
                    currentPets.push({text: `${qty}${ot}`});
                    document.getElementById('inp-pets-other-text').value='';
                } else { currentPets.push({text: `${qty}${type}`}); }
            }
            updatePetDisplay();
            window.validatePet(document.getElementById('inp-pets-string'));
        }
        window.removePet = function(idx) { currentPets.splice(idx, 1); updatePetDisplay(); window.validatePet(document.getElementById('inp-pets-string')); }
        function updatePetDisplay() {
            const c = document.getElementById('pet-list-display');
            if(currentPets.length===0) { c.innerHTML='<span class="text-gray-400 italic">å°šæœªæ–°å¢</span>'; document.getElementById('inp-pets-string').value=''; }
            else { c.innerHTML=currentPets.map((p,i)=>`<span class="bg-green-100 text-green-800 px-3 py-1 rounded flex items-center gap-2">${p.text} <button type="button" onclick="removePet(${i})" class="text-red-500 font-bold px-1">&times;</button></span>`).join(''); document.getElementById('inp-pets-string').value=currentPets.map(p=>p.text).join(', '); }
        }

        let currentMembers = [];
        window.toggleAgeInput = function() {
            const type = document.getElementById('mem-type').value;
            const group = document.getElementById('age-input-group');
            if(type === 'æˆäºº') group.classList.add('hidden'); else group.classList.remove('hidden');
        }
        window.addMember = function() {
            const type = document.getElementById('mem-type').value;
            const age = document.getElementById('mem-age').value;
            if(type !== 'æˆäºº' && !age) { alert('è«‹è¼¸å…¥å¹´é½¡'); return; }
            
            let text = "";
            if(type === 'æˆäºº') text = "1æˆäºº";
            else if (type === 'é›™èƒèƒ') text = `1é›™èƒèƒ(${age}æ­²)`; 
            else if (type === 'ä¸‰èƒèƒ') text = `1ä¸‰èƒèƒ(${age}æ­²)`;
            else text = `1${type}(${age}æ­²)`;
            
            currentMembers.push({text});
            updateMemberDisplay();
            document.getElementById('mem-age').value='';
            window.validateMember(document.getElementById('inp-members-string'));
        }
        window.removeMember = function(i) { currentMembers.splice(i, 1); updateMemberDisplay(); window.validateMember(document.getElementById('inp-members-string')); }
        function updateMemberDisplay() {
            const c = document.getElementById('member-list-display');
            c.innerHTML = currentMembers.map((m,i)=>`<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded flex items-center gap-2">${m.text} <button type="button" onclick="removeMember(${i})" class="text-red-500 font-bold px-1">&times;</button></span>`).join('');
            let s = currentMembers.map(m=>m.text);
            document.getElementById('inp-members-string').value = s.join(', ');
        }

        window.toggleRoomOther = function() { const v = document.getElementById('inp-room').value; if(v==='å…¶ä»–') document.getElementById('inp-room-other').classList.remove('hidden'); else document.getElementById('inp-room-other').classList.add('hidden'); }
        window.toggleNatOther = function() { const v = document.getElementById('inp-nationality').value; if(v==='Other') document.getElementById('inp-nationality-other').classList.remove('hidden'); else document.getElementById('inp-nationality-other').classList.add('hidden'); }
        window.adjustSalary = function(val) { let el = document.getElementById('inp-salary'); let v = parseInt(el.value); if(isNaN(v)) v = 5100; v += val; if(v < 5100) v = 5100; el.value = v; window.validate(el); }
        
        window.clearInputForm = function() {
            if(!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¡«å¯«å…§å®¹å—ï¼Ÿ")) return;
            inputCache = null;
            const form = document.getElementById('employer-form');
            form.reset();
            currentMembers = [];
            currentPets = [];
            updateMemberDisplay();
            updatePetDisplay();
            toggleNatOther();
            toggleRoomOther();
            togglePetInputs();
            toggleTagOther();
            document.querySelectorAll('.tag-checkbox').forEach(c => c.checked = false);
            document.querySelectorAll('.overseas-check').forEach(c => c.checked = false);
            document.querySelectorAll('.error-msg').forEach(e => e.classList.remove('visible'));
            document.querySelectorAll('.input-error').forEach(e => e.classList.remove('input-error'));
            document.getElementById('inp-inquiry-date').valueAsDate = new Date();
            document.getElementById('edit-doc-id').value = '';
            document.getElementById('inp-id').value = getNextId('E');
        }

        function snapshotInputForm() {
            inputCache = {
                id: document.getElementById('inp-id').value,
                location: document.getElementById('inp-location').value,
                flatSize: document.getElementById('inp-flat-size').value,
                nationality: document.getElementById('inp-nationality').value,
                nationalityOther: document.getElementById('inp-nationality-other').value,
                room: document.getElementById('inp-room').value,
                roomOther: document.getElementById('inp-room-other').value,
                date: document.getElementById('inp-date').value,
                salary: document.getElementById('inp-salary').value,
                lang: document.getElementById('inp-lang').value,
                empReq: document.getElementById('inp-emp-req').value,
                remarks: document.getElementById('inp-remarks').value,
                empName: document.getElementById('inp-emp-name').value,
                empLang: document.getElementById('inp-emp-lang').value,
                empPhone: document.getElementById('inp-emp-phone').value,
                inqDate: document.getElementById('inp-inquiry-date').value,
                referrer: document.getElementById('inp-referrer').value,
                editDocId: document.getElementById('edit-doc-id').value,
                members: [...currentMembers],
                pets: [...currentPets],
                tags: Array.from(document.querySelectorAll('.tag-checkbox:checked')).map(c => c.value),
                overseas: Array.from(document.querySelectorAll('.overseas-check:checked')).map(c => c.value),
                tagOtherChecked: document.getElementById('tag-other-check').checked,
                tagOtherText: document.getElementById('tag-other-text').value,
                petOtherText: document.getElementById('inp-pets-other-text').value
            };
        }

        function restoreInputForm() {
            if (!inputCache) return;
            document.getElementById('inp-id').value = inputCache.id;
            document.getElementById('inp-location').value = inputCache.location;
            document.getElementById('inp-flat-size').value = inputCache.flatSize;
            document.getElementById('inp-nationality').value = inputCache.nationality;
            document.getElementById('inp-nationality-other').value = inputCache.nationalityOther;
            document.getElementById('inp-room').value = inputCache.room;
            document.getElementById('inp-room-other').value = inputCache.roomOther;
            document.getElementById('inp-date').value = inputCache.date;
            document.getElementById('inp-salary').value = inputCache.salary;
            document.getElementById('inp-lang').value = inputCache.lang;
            document.getElementById('inp-emp-req').value = inputCache.empReq;
            document.getElementById('inp-remarks').value = inputCache.remarks;
            document.getElementById('inp-emp-name').value = inputCache.empName;
            document.getElementById('inp-emp-lang').value = inputCache.empLang;
            document.getElementById('inp-emp-phone').value = inputCache.empPhone;
            document.getElementById('inp-inquiry-date').value = inputCache.inqDate;
            document.getElementById('inp-referrer').value = inputCache.referrer;
            document.getElementById('edit-doc-id').value = inputCache.editDocId;
            currentMembers = [...inputCache.members];
            updateMemberDisplay();
            currentPets = [...inputCache.pets];
            updatePetDisplay();
            document.querySelectorAll('.tag-checkbox').forEach(c => c.checked = inputCache.tags.includes(c.value));
            document.querySelectorAll('.overseas-check').forEach(c => c.checked = inputCache.overseas.includes(c.value));
            document.getElementById('tag-other-check').checked = inputCache.tagOtherChecked;
            document.getElementById('tag-other-text').value = inputCache.tagOtherText;
            document.getElementById('inp-pets-other-text').value = inputCache.petOtherText;
            toggleNatOther();
            toggleRoomOther();
            toggleTagOther();
            togglePetInputs();
        }

        window.handleSave = async function() {
            const btn = document.getElementById('btn-save');
            btn.disabled = true; document.getElementById('btn-save-text').innerText = "è™•ç†ä¸­...";
            const isFishing = !document.getElementById('fishing-header').classList.contains('hidden');
            
            try {
                const id = document.getElementById('inp-id').value;
                const loc = document.getElementById('inp-location').value;
                let nat = document.getElementById('inp-nationality').value; if(nat === 'Other') nat = document.getElementById('inp-nationality-other').value;
                const memStr = document.getElementById('inp-members-string').value;
                const petStr = document.getElementById('inp-pets-string').value;
                let room = document.getElementById('inp-room').value; if(room === 'å…¶ä»–') room = document.getElementById('inp-room-other').value;
                const date = document.getElementById('inp-date').value;
                const salary = document.getElementById('inp-salary').value;
                const lang = document.getElementById('inp-lang').value;
                const remarks = document.getElementById('inp-remarks').value;

                let tags = [];
                document.querySelectorAll('.tag-checkbox:checked').forEach(c => tags.push(c.value));
                if(document.getElementById('tag-other-check').checked) { const ot = document.getElementById('tag-other-text').value; if(ot) tags.push(ot); }
                const tagStr = tags.join(', ');

                let overseasStr="", flatSize="", empReq="", empName="", empLang="", empPhone="", inqDate="", referrer="";
                
                const isU = id && id.toUpperCase().startsWith('U');

                if (!isFishing) {
                    let overseasArr = [];
                    document.querySelectorAll('.overseas-check:checked').forEach(c => overseasArr.push(c.value));
                    overseasStr = overseasArr.join(', ');
                    flatSize = document.getElementById('inp-flat-size').value;
                    empReq = document.getElementById('inp-emp-req').value;
                    empName = document.getElementById('inp-emp-name').value;
                    empLang = document.getElementById('inp-emp-lang').value;
                    empPhone = document.getElementById('inp-emp-phone').value;
                    inqDate = document.getElementById('inp-inquiry-date').value;
                    referrer = document.getElementById('inp-referrer').value;

                    // Validation
                    window.validate(document.getElementById('inp-id'));
                    window.validate(document.getElementById('inp-location'));
                    window.validate(document.getElementById('inp-nationality'));
                    window.validate(document.getElementById('inp-room'));
                    window.validate(document.getElementById('inp-date'));
                    window.validate(document.getElementById('inp-salary'));
                    window.validate(document.getElementById('inp-lang'));
                    window.validateMember(document.getElementById('inp-members-string'));
                    window.validatePet(document.getElementById('inp-pets-string'));
                    
                    if (!isU) {
                        window.validate(document.getElementById('inp-flat-size'));
                        window.validate(document.getElementById('inp-emp-name'));
                        window.validate(document.getElementById('inp-emp-lang'));
                        window.validate(document.getElementById('inp-emp-phone'));
                        window.validate(document.getElementById('inp-inquiry-date'));
                        window.validate(document.getElementById('inp-referrer'));
                        const osValid = window.validateOverseas();
                        if(!osValid) throw new Error('ä½ æ¼å¡«äº†å•é¡Œ');
                    }

                    window.validateTagOther(document.getElementById('tag-other-text'));
                    window.validateOther(document.getElementById('inp-room-other'), 'inp-room');
                    window.validateOther(document.getElementById('inp-nationality-other'), 'inp-nationality');

                    const tagOtherCheck = document.getElementById('tag-other-check');
                    if(tagOtherCheck.checked && !document.getElementById('tag-other-text').value) throw new Error('ä½ æ¼å¡«äº†å•é¡Œ');

                    if(document.getElementById('inp-room').value === 'å…¶ä»–' && !document.getElementById('inp-room-other').value) throw new Error('ä½ æ¼å¡«äº†å•é¡Œ');
                    if(document.getElementById('inp-nationality').value === 'Other' && !document.getElementById('inp-nationality-other').value) throw new Error('ä½ æ¼å¡«äº†å•é¡Œ');

                    if (isU) {
                         if (!id || !loc || !nat || !memStr || !petStr || !room || !date || !salary || !lang) {
                            throw new Error('ä½ æ¼å¡«äº†å•é¡Œï¼Œè«‹æª¢æŸ¥å’Œå¡«å¯«æ‰€æœ‰å•é¡Œæ‰å¯ä»¥ä¸Šè¼‰æˆåŠŸ');
                        }
                    } else {
                        if (!id || !loc || !nat || !memStr || !petStr || !room || !date || !salary || !lang || !flatSize || !empName || !empLang || !empPhone || !inqDate || !referrer) {
                            throw new Error('ä½ æ¼å¡«äº†å•é¡Œï¼Œè«‹æª¢æŸ¥å’Œå¡«å¯«æ‰€æœ‰å•é¡Œæ‰å¯ä»¥ä¸Šè¼‰æˆåŠŸ');
                        }
                    }
                } else {
                    if (!id || !loc || !nat || !memStr || !petStr || !room || !date || !salary || !lang) {
                        throw new Error('ä½ æ¼å¡«äº†å•é¡Œï¼Œè«‹æª¢æŸ¥å’Œå¡«å¯«æ‰€æœ‰å•é¡Œæ‰å¯ä»¥ä¸Šè¼‰æˆåŠŸ');
                    }
                }

                if (parseInt(salary) < 5100) { alert('è–ªé‡‘éŒ¯èª¤ï¼Œé‡æ–°å¡«å¯«'); throw new Error('è–ªé‡‘éŒ¯èª¤'); }

                const dataObj = {
                    id, location: loc, nationality: nat, members: memStr, pets: petStr, room, date, salary, lang, remarks,
                    tags: tagStr,
                    overseas_local: overseasStr,
                    flat_size: flatSize,
                    emp_req: empReq,
                    emp_name: empName,
                    emp_lang: empLang,
                    emp_phone: empPhone,
                    inq_date: inqDate,
                    referrer: referrer,
                    active: true,
                    updated_at: new Date().toISOString()
                };

                const docId = document.getElementById('edit-doc-id').value;
                if (window.isFirebaseMode) {
                    if (docId) await window.updateDoc(window.doc(window.db, "employers", docId), dataObj);
                    else await window.addDoc(window.collection(window.db, "employers"), dataObj);
                } else {
                    // å–®æ©Ÿæ¨¡å¼Fallback
                    if (docId) { 
                        const idx = employers.findIndex(e => e.docId === docId); 
                        if (idx !== -1) employers[idx] = { ...dataObj, docId }; 
                    } else { 
                        dataObj.docId = String(Date.now());
                        employers.push(dataObj); 
                    }
                    employers.sort((a, b) => a.id.localeCompare(b.id));
                    
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(employers));
                    refreshCurrentView();
                }

                inputCache = null;

                // Sync to Google Sheets (Backup Write Only)
                if (window.GOOGLE_SCRIPT_URL) { 
                    sendToGoogleSheets(dataObj); 
                }

                if (isFishing) { 
                    alert('ä¸Šè¼‰æˆåŠŸåŠå·²ä¸Šæ¶'); 
                    switchAdminSub('list'); 
                } else { 
                    if (docId) {
                        alert('è³‡æ–™å·²æ›´æ”¹åŠä¸Šæ¶'); 
                    } else {
                        alert('ä¸Šè¼‰æˆåŠŸåŠå·²ä¸Šæ¶');
                        document.getElementById('employer-form').reset();
                        document.getElementById('edit-doc-id').value = '';
                        currentMembers = []; updateMemberDisplay();
                        currentPets = []; updatePetDisplay();
                        document.getElementById('inp-id').value = getNextId('E');
                        document.getElementById('inp-inquiry-date').valueAsDate = new Date();
                    }
                    switchAdminSub('list'); 
                }

            } catch (e) {
                if(!e.message.includes('è–ªé‡‘éŒ¯èª¤')) alert(e.message);
            } finally {
                btn.disabled = false; document.getElementById('btn-save-text').innerText = "ä¸Šè¼‰è³‡æ–™";
            }
        };

        async function sendToGoogleSheets(data) {
            try {
                await fetch(window.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                console.log('Sent to Sheets backup');
            } catch (e) {
                console.error('Sheet Error', e);
            }
        }

        window.toggleActive = async function(docId, currentStatus) {
            if (window.isFirebaseMode) { await window.updateDoc(window.doc(window.db, "employers", docId), { active: !currentStatus }); }
            else { const emp = employers.find(e => e.docId === docId); if(emp) { emp.active = !currentStatus; localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(employers)); refreshCurrentView(); } }
        };
        window.deleteEmp = async function(docId) {
            if(!confirm('ç¢ºèªåˆªé™¤ï¼Ÿé€™å°‡æ°¸ä¹…ç§»é™¤è³‡æ–™ã€‚')) return; if(!confirm('å†æ¬¡ç¢ºèªï¼šæ‚¨ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤è³‡æ–™å—ï¼Ÿ')) return;
            if(window.isFirebaseMode) { await window.deleteDoc(window.doc(window.db, "employers", docId)); }
            else { const idx = employers.findIndex(e => e.docId === docId); if(idx > -1) { employers.splice(idx, 1); localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(employers)); refreshCurrentView(); } }
        };
        window.editEmp = function(docId) {
            const e = employers.find(emp => emp.docId === docId);
            if(!e) return;
            
            document.getElementById('inp-id').value = e.id;
            document.getElementById('inp-location').value = e.location;
            const stdNat = ['Filipino','Indonesian','Filipino & Indonesian','Indonesian & Filipino'];
            if(stdNat.includes(e.nationality)) { document.getElementById('inp-nationality').value = e.nationality; toggleNatOther(); }
            else { document.getElementById('inp-nationality').value = 'Other'; toggleNatOther(); document.getElementById('inp-nationality-other').value = e.nationality; }
            document.getElementById('inp-room').value = e.room; 
            if(e.room && !['æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','èˆ‡å°å­©åŒæˆ¿','èˆ‡é•·è€…åŒæˆ¿','èˆ‡å¦å¤–å‚­åŒæˆ¿','èˆ‡å¥³åƒ±ä¸»åŒæˆ¿'].includes(e.room)){
                 document.getElementById('inp-room').value = 'å…¶ä»–'; toggleRoomOther(); document.getElementById('inp-room-other').value = e.room;
            }
            document.getElementById('inp-date').value = e.date;
            document.getElementById('inp-salary').value = e.salary;
            document.getElementById('inp-lang').value = e.lang;
            document.getElementById('inp-remarks').value = e.remarks || '';
            
            if(document.getElementById('inp-flat-size')) {
                document.getElementById('inp-flat-size').value = e.flat_size || '';
                document.getElementById('inp-emp-req').value = e.emp_req || '';
                document.getElementById('inp-emp-name').value = e.emp_name || '';
                document.getElementById('inp-emp-lang').value = e.emp_lang || '';
                document.getElementById('inp-emp-phone').value = e.emp_phone || '';
                document.getElementById('inp-inquiry-date').value = e.inquiry_date || '';
                document.getElementById('inp-referrer').value = e.referrer || '';
                
                const os = (e.overseas_local || '').split(', ');
                document.querySelectorAll('.overseas-check').forEach(c => c.checked = os.includes(c.value));
            }

            const ts = (e.tags || '').split(', ');
            document.querySelectorAll('.tag-checkbox').forEach(c => c.checked = ts.includes(c.value));
            const stdTags = tagList;
            const customTag = ts.find(t => !stdTags.includes(t) && t.trim() !== '');
            if(customTag) {
                document.getElementById('tag-other-check').checked = true;
                document.getElementById('tag-other-text').value = customTag;
                toggleTagOther();
            }

            document.getElementById('edit-doc-id').value = docId;
            currentMembers = []; e.members.split(', ').forEach(p => currentMembers.push({text: p})); updateMemberDisplay();
            currentPets = []; if(e.pets) e.pets.split(', ').forEach(p => currentPets.push({text: p})); updatePetDisplay();
            
            snapshotInputForm();
            switchAdminSub('input'); window.scrollTo(0,0);
        };

        window.switchTab = function(tab) {
            document.getElementById('page-login').classList.add('hidden-section');
            document.getElementById('page-admin').classList.add('hidden-section');
            document.getElementById('page-public').classList.add('hidden-section');
            document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active'));
            document.getElementById('nav-' + tab).classList.add('active');
            if (tab === 'admin') {
                if (sessionStorage.getItem('isAdminLoggedIn') === 'true') { document.getElementById('page-admin').classList.remove('hidden-section'); switchAdminSub('input'); }
                else { document.getElementById('page-login').classList.remove('hidden-section'); }
            } else {
                document.getElementById('page-public').classList.remove('hidden-section');
                currentLang = tab; currentPage = 1; renderPublicList();
            }
        };
        window.checkLogin = function() {
            if (document.getElementById('admin-password').value === PASSWORD) { sessionStorage.setItem('isAdminLoggedIn', 'true'); document.getElementById('login-error').classList.add('hidden'); document.getElementById('admin-password').value = ''; switchTab('admin'); }
            else { document.getElementById('login-error').classList.remove('hidden'); }
        };
        
        window.switchAdminSub = function(sub) {
            if (currentAdminSub === 'input' && sub !== 'input') {
                snapshotInputForm();
            }

            document.getElementById('admin-input-area').classList.add('hidden'); document.getElementById('admin-list-area').classList.add('hidden');
            document.getElementById('fishing-header').classList.add('hidden'); document.getElementById('fishing-footer').classList.add('hidden');
            document.getElementById('clear-btn-container').classList.add('hidden');
            
            const internalFields = document.querySelectorAll('.input-only-field');
            
            if (sub === 'input') {
                document.getElementById('admin-input-area').classList.remove('hidden');
                document.getElementById('clear-btn-container').classList.remove('hidden');
                internalFields.forEach(f => f.classList.remove('hidden'));
                
                if (inputCache) {
                    restoreInputForm();
                } else {
                    if(document.getElementById('edit-doc-id').value === '') {
                        document.getElementById('employer-form').reset();
                        currentMembers=[]; updateMemberDisplay();
                        currentPets=[]; updatePetDisplay();
                        document.getElementById('inp-inquiry-date').valueAsDate = new Date();
                        document.getElementById('inp-id').value = getNextId('E');
                    }
                }
            }
            else if (sub === 'fishing') {
                document.getElementById('admin-input-area').classList.remove('hidden');
                document.getElementById('fishing-header').classList.remove('hidden');
                document.getElementById('fishing-footer').classList.remove('hidden');
                internalFields.forEach(f => f.classList.add('hidden')); 
                
                document.getElementById('employer-form').reset();
                generateFishingData();
            }
            else if (sub === 'list') {
                document.getElementById('admin-list-area').classList.remove('hidden');
                currentAdminPage = 1;
                renderAdminList();
            }
            
            currentAdminSub = sub;
        };

        window.changeAdminPage = function(dir) {
            const totalPages = Math.ceil(employers.length / itemsPerPage);
            let newPage = currentAdminPage + dir;
            if (newPage < 1) newPage = 1; else if (newPage > totalPages) newPage = totalPages;
            if (newPage !== currentAdminPage) { currentAdminPage = newPage; renderAdminList(); window.scrollTo(0, 0); }
        };

        function formatMembersForDisplay(text) {
            if(!text) return '-';
            const parts = text.split(', ');
            let adultCount = 0;
            let others = [];
            parts.forEach(p => {
                if(p.includes('æˆäºº')) {
                    const match = p.match(/(\d+)æˆäºº/);
                    if(match) adultCount += parseInt(match[1]);
                    else adultCount += 1;
                } else {
                    others.push(p);
                }
            });
            let res = [];
            if(adultCount > 0) res.push(`${adultCount}æˆäºº`);
            res = res.concat(others);
            return res.join(', ');
        }

        function formatPetsForDisplay(text) {
            if(!text) return '-';
            if(text === 'æ²’æœ‰å¯µç‰©') return text;
            
            const parts = text.split(', ');
            const petCounts = {};
            const targetTypes = ['å°ç‹—','ä¸­ç‹—','å¤§ç‹—','è²“','å…”','é¸šéµ¡','çƒé¾œ'];
            let others = [];

            parts.forEach(p => {
                let matched = false;
                for(let t of targetTypes) {
                    if(p.includes(t)) {
                        const match = p.match(/^(\d+)(.+)$/);
                        if(match && match[2] === t) {
                            petCounts[t] = (petCounts[t] || 0) + parseInt(match[1]);
                            matched = true;
                            break;
                        }
                    }
                }
                if(!matched) others.push(p);
            });

            let res = [];
            for(let t in petCounts) {
                res.push(`${petCounts[t]}${t}`);
            }
            return res.concat(others).join(', ');
        }

        function renderAdminList() {
            const c = document.getElementById('admin-records-container'); c.innerHTML = '';
            document.getElementById('db-status-text').innerText = window.isFirebaseMode ? "(Firebase Cloud)" : (window.isGoogleSheetMode ? "(Google Sheet)" : "(Offline)");
            
            if(employers.length === 0) { c.innerHTML = '<p class="text-center text-gray-400">æš«ç„¡è³‡æ–™</p>'; return; }

            const totalPages = Math.ceil(employers.length / itemsPerPage);
            const start = (currentAdminPage - 1) * itemsPerPage;
            const pageData = employers.slice(start, start + itemsPerPage);

            document.getElementById('admin-pagination').classList.remove('hidden');
            document.getElementById('admin-page-indicator').innerText = `Page ${currentAdminPage} / ${totalPages || 1}`;

            pageData.forEach((e) => {
                const status = e.active ? '<span class="text-green-600 font-bold">[ä¸Šæ¶ä¸­]</span>' : '<span class="text-red-600 font-bold">[å·²ä¸‹æ¶]</span>';
                const tTags = e.tags ? `<p class="col-span-full"><span class="font-bold">æ¨™ç±¤:</span> ${e.tags}</p>` : '';
                
                const dispMem = formatMembersForDisplay(e.members);
                const dispPet = formatPetsForDisplay(e.pets);

                const html = `
                    <div class="bg-white p-6 rounded-lg shadow border border-l-8 ${e.active ? 'border-l-green-500' : 'border-l-red-500'}">
                        <div class="flex flex-col sm:flex-row justify-between items-start mb-4 pb-2 border-b">
                            <h4 class="font-bold text-blue-800">${e.id} ${status}</h4>
                            <div class="space-x-2 mt-2 sm:mt-0">
                                <button onclick="editEmp('${e.docId}')" class="bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">ä¿®æ”¹</button>
                                <button onclick="toggleActive('${e.docId}', ${e.active})" class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded hover:bg-yellow-200">${e.active ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}</button>
                                <button onclick="deleteEmp('${e.docId}')" class="bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200">åˆªé™¤</button>
                            </div>
                        </div>
                        <div class="text-gray-700">
                            <p class="font-bold text-blue-600 mb-2">å…¬é–‹è³‡æ–™ï¼š</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2">
                                <p><span class="font-bold">æˆå“¡:</span> ${dispMem}</p>
                                <p><span class="font-bold">åœ°å€:</span> ${e.location}</p>
                                <p><span class="font-bold">å¯µç‰©:</span> ${dispPet}</p>
                                <p><span class="font-bold">æˆ¿é–“:</span> ${e.room}</p>
                                <p><span class="font-bold">ä¸Šç­:</span> ${e.date}</p>
                                <p><span class="font-bold">è–ªé‡‘:</span> $${e.salary}</p>
                                <p><span class="font-bold">åœ‹ç±:</span> ${e.nationality||'-'}</p>
                                <p><span class="font-bold">èªè¨€:</span> ${e.lang}</p>
                                <p class="col-span-full"><span class="font-bold">å‚™è¨»:</span> ${e.remarks || '-'}</p>
                                ${tTags}
                            </div>
                            
                            <div class="mt-4 p-4 rounded bg-blue-50 border border-blue-200">
                                <p class="font-bold text-blue-600 mb-2">å…§éƒ¨ç´€éŒ„ï¼š</p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-2">
                                    <p><span class="font-bold">å–®ä½å‘æ•¸:</span> ${e.flat_size||'-'}</p>
                                    <p><span class="font-bold">è«®è©¢é¡åˆ¥:</span> ${e.overseas_local||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»è¦æ±‚:</span> ${e.emp_req||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»å§“å:</span> ${e.emp_name||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»èªè¨€:</span> ${e.emp_lang||'-'}</p>
                                    <p><span class="font-bold">åƒ±ä¸»é›»è©±:</span> ${e.emp_phone||'-'}</p>
                                    <p><span class="font-bold">æŸ¥è©¢æ—¥æœŸ:</span> ${e.inquiry_date||'-'}</p>
                                    <p><span class="font-bold">ä»‹ç´¹äºº:</span> ${e.referrer||'-'}</p>
                                </div>
                            </div>
                        </div>
                    </div>`;
                c.innerHTML += html;
            });
        }

        window.generateFishingData = function() {
            document.getElementById('inp-id').value = getNextId('U');
            
            const st = Object.keys(locationMap); document.getElementById('inp-location').value = st[Math.floor(Math.random()*st.length)];
            const nats = ['Filipino', 'Indonesian', 'Filipino & Indonesian', 'Indonesian & Filipino'];
            document.getElementById('inp-nationality').value = nats[Math.floor(Math.random()*nats.length)]; toggleNatOther();
            
            currentMembers = [];
            const a = Math.floor(Math.random()*2)+1; 
            for(let i=0; i<a; i++) currentMembers.push({text: `${Math.floor(Math.random()*3)+1}æˆäºº`});
            if(Math.random()>0.5) { const k = Math.floor(Math.random()*2)+1; currentMembers.push({text: `${k}å°å­©(${Math.floor(Math.random()*17)}æ­²)`}); }
            if(Math.random()>0.7) { const e = Math.floor(Math.random()*2)+1; currentMembers.push({text: `${e}é•·è€…(${Math.floor(Math.random()*31)+60}æ­²)`}); }
            updateMemberDisplay();

            currentPets = [];
            const pTypes = ['æ²’æœ‰å¯µç‰©', 'å°ç‹—', 'ä¸­ç‹—', 'å¤§ç‹—', 'è²“'];
            const p = pTypes[Math.floor(Math.random()*pTypes.length)];
            if(p === 'æ²’æœ‰å¯µç‰©') currentPets.push({text: 'æ²’æœ‰å¯µç‰©'}); else { const qty = Math.floor(Math.random()*2)+1; currentPets.push({text: `${qty}${p}`}); }
            updatePetDisplay();

            const rOpts = ['æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','æœ‰å·¥äººæˆ¿','èˆ‡å°å­©åŒæˆ¿','èˆ‡é•·è€…åŒæˆ¿','èˆ‡å¦å¤–å‚­åŒæˆ¿','èˆ‡å¥³åƒ±ä¸»åŒæˆ¿'];
            document.getElementById('inp-room').value = rOpts[Math.floor(Math.random()*rOpts.length)]; toggleRoomOther();
            const sals = [5100, 5300, 5500, 5500, 5500, 5800, 6000]; document.getElementById('inp-salary').value = sals[Math.floor(Math.random()*sals.length)];
            const langs = ['è‹±æ–‡','è‹±æ–‡','è‹±æ–‡','å»£æ±è©±','æ™®é€šè©±','è‹±æ–‡&å»£æ±è©±','è‹±æ–‡&æ™®é€šè©±']; document.getElementById('inp-lang').value = langs[Math.floor(Math.random()*langs.length)];
            document.getElementById('inp-date').value = 'ç›¡å¿«'; document.getElementById('inp-remarks').value = '';
            
            document.querySelectorAll('.tag-checkbox').forEach(c => c.checked = false);
            document.getElementById('tag-other-check').checked = false; toggleTagOther();
            const allowedTags = ["æ€¥ Urgent", "é«˜è–ª High salary", "è¿‘åœ°éµ Near MTR", "å¥½åƒ±ä¸» Good employer", 
                                 "ä¸€å€‹å°å­© 1 child only", "ä¸€å€‹é•·è€… 1 elderly only", "2å€‹é•·è€… 2 elderly only", "3å€‹é•·è€… 3 elderly only",
                                 "ä¸€ä½æˆäºº 1 adult only", "2ä½æˆäºº 2 adult only", "3ä½æˆäºº 3 adult only"];
            const numTags = Math.floor(Math.random() * 3);
            let choices = allowedTags.sort(() => 0.5 - Math.random()).slice(0, numTags);
            choices.forEach(t => { const el = document.getElementById(`tag-${t}`); if(el) el.checked = true; });
        };

        function renderPublicList() {
            const container = document.getElementById('public-records-container'); container.innerHTML = '';
            const activeEmps = employers.filter(e => e.active);
            const totalPages = Math.ceil(activeEmps.length / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage;
            const pageData = activeEmps.slice(start, start + itemsPerPage);
            const isEn = currentLang === 'english';
            
            const bannerBox = document.getElementById('banner-box');
            const bannerText = document.getElementById('banner-text');
            bannerBox.className = "w-full max-w-5xl mb-6 p-6 rounded-lg text-left shadow-md border-l-8 bg-blue-50 border-blue-300 text-black";
            
            const footerMsg = document.getElementById('public-footer-msg');
            footerMsg.className = "w-full max-w-5xl p-4 text-center rounded-lg mt-4 hidden shadow-md border-l-8";
            
            if(isEn) {
                bannerText.innerHTML = "ğŸ’µ All helpers NO placement fee, NO agency fee, NO registration fee.<br><br>ğŸ’¼ Apply job or refer your friends? Click the green button below to WhatsApp us.<br><br>ğŸ¤ In our agency, you have the Right to choose your next preferred employer, we do not force you to choose, refer your friends and family now.";
                bannerText.style.fontSize = "30px";
                document.getElementById('public-title').innerText = 'Employer List'; 
                document.getElementById('nav-indonesian').innerText = 'ğŸ‡®ğŸ‡© Indonesian';
                document.getElementById('btn-prev').innerText = 'Prev'; document.getElementById('btn-next').innerText = 'Next';
                
                footerMsg.innerHTML = "If you still havenâ€™t found employer you like, please contact us on WhatsApp, we will help you find one that you like.";
                footerMsg.classList.add('bg-blue-50', 'border-blue-300');
            } else {
                bannerText.innerHTML = "ğŸ’µ Semua pekerja tanpa biaya penempatan, tanpa biaya agen, dan tanpa biaya pendaftaran.<br><br>ğŸ’¼ Ingin melamar kerja atau merekomendasikan teman? Klik tombol hijau di bawah untuk WhatsApp kami.<br><br>ğŸ¤ Di Agen Ketenagakerjaan kami, Anda memiliki hak untuk memilih majikan berikutnya yang Anda inginkan. Kami tidak memaksa Anda untuk memilih. Rekomendasikan teman dan keluarga Anda sekarang.";
                bannerText.style.fontSize = "30px";
                document.getElementById('public-title').innerText = 'Daftar Majikan';
                document.getElementById('nav-indonesian').innerText = 'ğŸ‡®ğŸ‡© Indonesian';
                document.getElementById('btn-prev').innerText = 'Sebelumnya'; document.getElementById('btn-next').innerText = 'Berikutnya';
                
                footerMsg.innerHTML = "Jika Anda masih belum menemukan majikan yang Anda sukai, silakan hubungi kami melalui WhatsApp. Kami akan membantu Anda menemukan yang sesuai dengan keinginan Anda.";
                footerMsg.classList.add('bg-blue-50', 'border-blue-300');
            }
            
            footerMsg.classList.remove('hidden');

            if(pageData.length === 0) { container.innerHTML = '<div class="col-span-full text-center p-10 text-gray-500">No Data / Tidak Ada Data</div>'; updatePageIndicator(0, 0, isEn); return; }

            pageData.forEach(e => {
                const tLoc = translateText(e.location, currentLang);
                const tNat = e.nationality; 
                const tMem = translateMembers(e.members, currentLang); 
                const tPet = translatePets(e.pets, currentLang);
                const tRoom = getDict(e.room, currentLang);
                const tDate = getDict(e.date, currentLang);
                const tLang = getDict(e.lang, currentLang);
                let tRem = e.remarks; if (!isEn && e.remarks) tRem = e.remarks.replace(/å¥½åƒ±ä¸»/g, 'Majikan Baik').replace(/æº–æ™‚å‡ºç³§/g, 'Gaji Tepat Waktu');

                let tagHtml = '';
                if(e.tags) {
                    const tagArr = e.tags.split(', ');
                    tagHtml = '<div class="mb-4 flex flex-wrap gap-2">';
                    tagArr.forEach(t => {
                        let label = t;
                        if(isEn) {
                            const match = t.match(/^\d+[\u4e00-\u9fa5]+ (.+)$/);
                            if(match) label = match[1];
                            else {
                                const genMatch = t.match(/[\u4e00-\u9fa5]+ (.+)$/);
                                if(genMatch) label = genMatch[1];
                            }
                        } else {
                            label = tagMapIndo[t] || t;
                        }
                        tagHtml += `<span class="bg-pink-100 text-pink-800 border border-pink-200 px-3 py-1 rounded font-bold">${label}</span>`;
                    });
                    tagHtml += '</div>';
                }

                const idD = isEn ? `Employer Number: ${e.id}` : `Nomor Majikan: ${e.id}`;
                const salD = isEn ? `Salary` : `Gaji`;
                const petClass = (tPet.includes('No Pets') || tPet.includes('Tidak ada hewan')) ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const roomClass = (tRoom.includes('have own room') || tRoom.includes('ada kamar sendiri')) ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const dateClass = (tDate === 'ASAP' || tDate === 'Secepatnya') ? "text-red-600 font-bold" : "text-gray-800 font-medium";
                const waMsg = isEn ? `I'm interested in this Employer: ${e.id}` : `Saya tertarik dengan majikan ini (I'm interested in this Employer: ${e.id})`;
                const waBtnText = isEn ? "I'm interested in this Employer" : "Saya tertarik dengan majikan ini";
                const waLink = `https://wa.me/85296111003?text=${encodeURIComponent(waMsg)}`;

                const L = {
                    loc: isEn ? 'Employer Location' : 'Lokasi Majikan',
                    nat: isEn ? 'Nationality' : 'kebangsaan',
                    fam: isEn ? 'Employer Member & Age' : 'Anggota Keluarga & Usia',
                    pets: isEn ? 'Pets' : 'Hewan Peliharaan',
                    room: isEn ? 'Helper Room' : 'Kamar Pembantu',
                    date: isEn ? 'START of WORK DAY' : 'Mulai Hari Kerja',
                    lang: isEn ? 'Language' : 'Bahasa',
                    rem: isEn ? 'Remarks' : 'Catatan',
                };

                const html = `
                    <div class="bg-white rounded-xl shadow-xl border-t-8 border-blue-600 overflow-hidden flex flex-col p-8 space-y-5">
                        ${tagHtml}
                        <div class="flex flex-col border-b pb-4 mb-2">
                            <h3 class="font-bold text-gray-900">${idD}</h3>
                        </div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.nat}</p><p class="font-medium text-gray-800 text-3xl">${tNat}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.lang}</p><p class="font-medium text-blue-800 text-3xl">${tLang}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.fam}</p><p class="font-medium text-gray-800 text-3xl">${tMem}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.loc}</p><p class="font-medium text-gray-800 text-3xl">${tLoc}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.pets}</p><p class="${petClass} text-3xl">${tPet}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.room}</p><p class="${roomClass} text-3xl">${tRoom}</p></div>
                        <div><p class="text-gray-400 font-bold uppercase tracking-wide">${L.date}</p><p class="${dateClass} text-3xl">${tDate}</p></div>
                        <div>
                            <p class="text-gray-400 font-bold uppercase tracking-wide">${salD}</p>
                            <p class="font-bold text-black text-3xl">$${e.salary}</p>
                        </div>
                        ${e.remarks ? `<div class="bg-yellow-50 p-4 rounded border border-yellow-100"><p class="text-gray-700 font-bold uppercase">${L.rem}</p><p class="text-gray-700 italic text-xl">${tRem}</p></div>` : ''}
                        
                        <a href="${waLink}" target="_blank" class="block w-full text-center bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl mt-6 shadow transition text-3xl">
                            <i class="fa-brands fa-whatsapp mr-2"></i> ${waBtnText}
                        </a>
                    </div>
                `;
                container.innerHTML += html;
            });
            updatePageIndicator(currentPage, totalPages, isEn);
        }

        function updatePageIndicator(curr, total, isEn) {
            const label = isEn ? 'Page' : 'Halaman';
            document.getElementById('page-indicator').innerText = `${label} ${curr} / ${total || 1}`;
        }

        function translateText(text, lang) {
            if(!text) return '-'; let res = text;
            for(let cn in locationMap) { if(res.includes(cn)) res = res.replace(cn, locationMap[cn]); }
            return res;
        }

        function translateMembers(text, lang) {
            if(!text) return '-';
            const parts = text.split(', ');
            let adultCount = 0;
            let otherParts = [];
            
            parts.forEach(p => {
                if(p.includes('æˆäºº')) {
                    const match = p.match(/(\d+)æˆäºº/);
                    if(match) adultCount += parseInt(match[1]);
                    else adultCount += 1; 
                } else {
                    otherParts.push(p);
                }
            });

            let translatedOthers = otherParts.map(p => {
                let res = p;
                if(lang === 'english') {
                    res = res.replace(/å°å­©/g, ' Kid').replace(/é•·è€…/g, ' Elderly').replace(/ç”·å­©/g, ' Boy').replace(/å¥³å­©/g, ' Girl')
                             .replace(/é›™èƒèƒ/g, ' Twins').replace(/ä¸‰èƒèƒ/g, ' Triplets')
                             .replace(/å©†å©†/g, ' Grandma').replace(/å…¬å…¬/g, ' Grandpa').replace(/æ­²/g, 'yo');
                } else {
                    res = res.replace(/å°å­©/g, ' Anak').replace(/é•·è€…/g, ' Lansia').replace(/ç”·å­©/g, ' Anak Laki-laki').replace(/å¥³å­©/g, ' Anak Perempuan')
                             .replace(/é›™èƒèƒ/g, ' Kembar').replace(/ä¸‰èƒèƒ/g, ' Kembar Tiga')
                             .replace(/å©†å©†/g, ' Nenek').replace(/å…¬å…¬/g, ' Kakek').replace(/æ­²/g, 'th');
                }
                return res;
            });

            if(adultCount > 0) {
                const label = lang === 'english' ? 'Adult' : 'Dewasa';
                translatedOthers.unshift(`${adultCount} ${label}`);
            }
            
            return translatedOthers.join(', ');
        }

        function translatePets(text, lang) {
            if(!text) return '-'; if(text === 'æ²’æœ‰å¯µç‰©') return getDict('æ²’æœ‰å¯µç‰©', lang);
            
            const parts = text.split(', ');
            const petCounts = {};
            const targetTypes = ['å°ç‹—','ä¸­ç‹—','å¤§ç‹—','è²“','å…”','é¸šéµ¡','çƒé¾œ'];
            let others = [];

            parts.forEach(p => {
                let matched = false;
                for(let t of targetTypes) {
                    if(p.includes(t)) {
                        const match = p.match(/^(\d+)(.+)$/);
                        if(match && match[2] === t) {
                            petCounts[t] = (petCounts[t] || 0) + parseInt(match[1]);
                            matched = true;
                            break;
                        }
                    }
                }
                if(!matched) others.push(p);
            });

            const mergedParts = [];
            for(let t in petCounts) {
                mergedParts.push(`${petCounts[t]}${t}`);
            }
            const allParts = mergedParts.concat(others);

            const translatedParts = allParts.map(p => {
                const match = p.match(/^(\d+)(.+)$/);
                if(match) { const qty = match[1]; const name = match[2]; const tName = getDict(name, lang); return `${qty} ${tName}`; }
                return p; 
            });
            return translatedParts.join(', ');
        }
        function getDict(key, lang) {
            const t = lang === 'english' ? 'en' : 'id';
            if(dict[key] && dict[key][t]) return dict[key][t]; if(key && key.length > 0) return key; return '-';
        }
        window.changePage = function(dir) {
            const activeEmps = employers.filter(e => e.active);
            const totalPages = Math.ceil(activeEmps.length / itemsPerPage);
            let newPage = currentPage + dir;
            if (newPage < 1) newPage = 1; else if (newPage > totalPages) newPage = totalPages;
            if (newPage !== currentPage) { currentPage = newPage; renderPublicList(); window.scrollTo(0, 0); }
        };
    </script>
</body>
</html>
